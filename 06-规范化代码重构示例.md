# è§„èŒƒåŒ–ä»£ç é‡æ„ç¤ºä¾‹
## è®¢å•æœåŠ¡å®Œæ•´é‡æ„å®æˆ˜

---

## ğŸ“‹ é‡æ„è¯´æ˜

æœ¬æ–‡æ¡£å±•ç¤ºå¦‚ä½•å°†åˆçº§ä»£ç é‡æ„ä¸ºç¬¦åˆã€Šç”µå•†å¾®æœåŠ¡ä»£ç è§„èŒƒã€‹çš„ä¼˜é›…ä»£ç ã€‚

**é‡æ„å¯¹è±¡**ï¼šè®¢å•æœåŠ¡ï¼ˆorder-serviceï¼‰

**é‡æ„å†…å®¹**ï¼š
- âœ… å®Œæ•´çš„é¡¹ç›®ç»“æ„
- âœ… ç¬¦åˆè§„èŒƒçš„æ‰€æœ‰ä»£ç 
- âœ… å®Œæ•´çš„å¼‚å¸¸å¤„ç†
- âœ… å®Œæ•´çš„æ—¥å¿—è®°å½•
- âœ… å®Œæ•´çš„å•å…ƒæµ‹è¯•
- âœ… å¯ç›´æ¥ä½¿ç”¨

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šé¡¹ç›®ç»“æ„

```
order-service/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â””â”€â”€ com/
â”‚   â”‚   â”‚       â””â”€â”€ demo/
â”‚   â”‚   â”‚           â””â”€â”€ order/
â”‚   â”‚   â”‚               â”œâ”€â”€ OrderServiceApplication.java
â”‚   â”‚   â”‚               â”œâ”€â”€ controller/
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ OrderController.java
â”‚   â”‚   â”‚               â”œâ”€â”€ service/
â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ OrderService.java
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ impl/
â”‚   â”‚   â”‚               â”‚       â””â”€â”€ OrderServiceImpl.java
â”‚   â”‚   â”‚               â”œâ”€â”€ repository/
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ OrderRepository.java
â”‚   â”‚   â”‚               â”œâ”€â”€ entity/
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ Order.java
â”‚   â”‚   â”‚               â”œâ”€â”€ dto/
â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ OrderRequest.java
â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ OrderResponse.java
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ OrderQueryRequest.java
â”‚   â”‚   â”‚               â”œâ”€â”€ vo/
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ OrderVO.java
â”‚   â”‚   â”‚               â”œâ”€â”€ enums/
â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ OrderStatus.java
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ ErrorCode.java
â”‚   â”‚   â”‚               â”œâ”€â”€ exception/
â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ BusinessException.java
â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ OrderNotFoundException.java
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ GlobalExceptionHandler.java
â”‚   â”‚   â”‚               â”œâ”€â”€ factory/
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ OrderFactory.java
â”‚   â”‚   â”‚               â”œâ”€â”€ validator/
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ OrderValidator.java
â”‚   â”‚   â”‚               â”œâ”€â”€ event/
â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ OrderCreatedEvent.java
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ OrderEventPublisher.java
â”‚   â”‚   â”‚               â”œâ”€â”€ config/
â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ CacheConfig.java
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ SwaggerConfig.java
â”‚   â”‚   â”‚               â”œâ”€â”€ constant/
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ OrderConstants.java
â”‚   â”‚   â”‚               â””â”€â”€ util/
â”‚   â”‚   â”‚                   â””â”€â”€ OrderNoGenerator.java
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yml
â”‚   â”‚       â”œâ”€â”€ bootstrap.yml
â”‚   â”‚       â””â”€â”€ logback-spring.xml
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ java/
â”‚           â””â”€â”€ com/
â”‚               â””â”€â”€ demo/
â”‚                   â””â”€â”€ order/
â”‚                       â””â”€â”€ service/
â”‚                           â””â”€â”€ OrderServiceTest.java
â””â”€â”€ pom.xml
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šå®ä½“å±‚ï¼ˆEntityï¼‰

### Order.java

```java
package com.demo.order.entity;

import com.demo.order.enums.OrderStatus;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import javax.persistence.*;
import java.math.BigDecimal;
import java.time.LocalDateTime;

/**
 * è®¢å•å®ä½“
 * <p>
 * è®¢å•æ ¸å¿ƒä¸šåŠ¡å®ä½“ï¼ŒåŒ…å«è®¢å•çš„æ‰€æœ‰åŸºæœ¬ä¿¡æ¯
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Entity
@Table(name = "t_order", indexes = {
    @Index(name = "idx_order_no", columnList = "order_no", unique = true),
    @Index(name = "idx_user_id", columnList = "user_id"),
    @Index(name = "idx_status", columnList = "status"),
    @Index(name = "idx_create_time", columnList = "create_time")
})
@EntityListeners(AuditingEntityListener.class)
public class Order {
    
    /**
     * ä¸»é”®IDï¼ˆè‡ªå¢ï¼‰
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    /**
     * è®¢å•å·ï¼ˆå”¯ä¸€ï¼Œä¸šåŠ¡ä¸»é”®ï¼‰
     */
    @Column(name = "order_no", unique = true, nullable = false, length = 64)
    private String orderNo;
    
    /**
     * ç”¨æˆ·ID
     */
    @Column(name = "user_id", nullable = false)
    private Long userId;
    
    /**
     * å•†å“ID
     */
    @Column(name = "product_id", nullable = false)
    private Long productId;
    
    /**
     * å•†å“åç§°
     */
    @Column(name = "product_name", nullable = false, length = 255)
    private String productName;
    
    /**
     * è´­ä¹°æ•°é‡
     */
    @Column(name = "quantity", nullable = false)
    private Integer quantity;
    
    /**
     * è®¢å•é‡‘é¢
     */
    @Column(name = "total_amount", nullable = false, precision = 10, scale = 2)
    private BigDecimal totalAmount;
    
    /**
     * è®¢å•çŠ¶æ€
     * @see OrderStatus
     */
    @Enumerated(EnumType.STRING)
    @Column(name = "status", nullable = false, length = 20)
    private OrderStatus status;
    
    /**
     * å¤‡æ³¨
     */
    @Column(name = "remark", length = 500)
    private String remark;
    
    /**
     * åˆ›å»ºæ—¶é—´
     */
    @CreatedDate
    @Column(name = "create_time", nullable = false, updatable = false)
    private LocalDateTime createTime;
    
    /**
     * æ›´æ–°æ—¶é—´
     */
    @LastModifiedDate
    @Column(name = "update_time", nullable = false)
    private LocalDateTime updateTime;
    
    /**
     * é€»è¾‘åˆ é™¤æ ‡è®°ï¼ˆ0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤ï¼‰
     */
    @Column(name = "deleted", nullable = false)
    private Integer deleted = 0;
    
    /**
     * ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰
     */
    @Version
    @Column(name = "version", nullable = false)
    private Integer version = 0;
}
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šæšä¸¾å±‚ï¼ˆEnumsï¼‰

### OrderStatus.java

```java
package com.demo.order.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * è®¢å•çŠ¶æ€æšä¸¾
 * <p>
 * å®šä¹‰è®¢å•çš„æ‰€æœ‰å¯èƒ½çŠ¶æ€åŠå…¶æµè½¬è§„åˆ™
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Getter
@AllArgsConstructor
public enum OrderStatus {
    
    /**
     * å¾…æ”¯ä»˜
     */
    PENDING("å¾…æ”¯ä»˜", 0),
    
    /**
     * å·²æ”¯ä»˜
     */
    PAID("å·²æ”¯ä»˜", 1),
    
    /**
     * å¤„ç†ä¸­
     */
    PROCESSING("å¤„ç†ä¸­", 2),
    
    /**
     * å·²å‘è´§
     */
    SHIPPED("å·²å‘è´§", 3),
    
    /**
     * å·²å®Œæˆ
     */
    COMPLETED("å·²å®Œæˆ", 4),
    
    /**
     * å·²å–æ¶ˆ
     */
    CANCELLED("å·²å–æ¶ˆ", -1);
    
    /**
     * çŠ¶æ€æè¿°
     */
    private final String description;
    
    /**
     * çŠ¶æ€ç 
     */
    private final Integer code;
    
    /**
     * æ ¹æ®çŠ¶æ€ç è·å–æšä¸¾
     *
     * @param code çŠ¶æ€ç 
     * @return è®¢å•çŠ¶æ€æšä¸¾
     */
    public static OrderStatus fromCode(Integer code) {
        for (OrderStatus status : values()) {
            if (status.getCode().equals(code)) {
                return status;
            }
        }
        throw new IllegalArgumentException("æœªçŸ¥çš„è®¢å•çŠ¶æ€ç : " + code);
    }
    
    /**
     * æ˜¯å¦å¯ä»¥å–æ¶ˆ
     *
     * @return true-å¯ä»¥å–æ¶ˆï¼Œfalse-ä¸èƒ½å–æ¶ˆ
     */
    public boolean canCancel() {
        return this == PENDING || this == PAID;
    }
    
    /**
     * æ˜¯å¦æ˜¯ç»ˆæ€
     *
     * @return true-ç»ˆæ€ï¼Œfalse-éç»ˆæ€
     */
    public boolean isFinalStatus() {
        return this == COMPLETED || this == CANCELLED;
    }
}
```

### ErrorCode.java

```java
package com.demo.order.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * é”™è¯¯ç æšä¸¾
 * <p>
 * ç»Ÿä¸€å®šä¹‰ç³»ç»Ÿä¸­çš„æ‰€æœ‰é”™è¯¯ç 
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Getter
@AllArgsConstructor
public enum ErrorCode {
    
    // ========== æˆåŠŸ ==========
    
    /**
     * æ“ä½œæˆåŠŸ
     */
    SUCCESS(200, "æ“ä½œæˆåŠŸ"),
    
    // ========== å®¢æˆ·ç«¯é”™è¯¯ (4xx) ==========
    
    /**
     * å‚æ•°é”™è¯¯
     */
    PARAM_ERROR(400, "å‚æ•°é”™è¯¯"),
    
    /**
     * æœªæˆæƒ
     */
    UNAUTHORIZED(401, "æœªæˆæƒ"),
    
    /**
     * ç¦æ­¢è®¿é—®
     */
    FORBIDDEN(403, "ç¦æ­¢è®¿é—®"),
    
    /**
     * èµ„æºä¸å­˜åœ¨
     */
    NOT_FOUND(404, "èµ„æºä¸å­˜åœ¨"),
    
    // ========== ä¸šåŠ¡é”™è¯¯ (5xxx) ==========
    
    /**
     * è®¢å•ä¸å­˜åœ¨
     */
    ORDER_NOT_FOUND(5001, "è®¢å•ä¸å­˜åœ¨"),
    
    /**
     * è®¢å•çŠ¶æ€ä¸å…è®¸æ“ä½œ
     */
    ORDER_STATUS_ERROR(5002, "è®¢å•çŠ¶æ€ä¸å…è®¸æ“ä½œ"),
    
    /**
     * è®¢å•ä¸èƒ½å–æ¶ˆ
     */
    ORDER_CANNOT_CANCEL(5003, "è®¢å•ä¸èƒ½å–æ¶ˆ"),
    
    /**
     * è®¢å•é‡å¤
     */
    DUPLICATE_ORDER(5004, "è®¢å•é‡å¤"),
    
    /**
     * åº“å­˜ä¸è¶³
     */
    INSUFFICIENT_STOCK(5005, "åº“å­˜ä¸è¶³"),
    
    /**
     * ç”¨æˆ·ä¸å­˜åœ¨
     */
    USER_NOT_FOUND(5101, "ç”¨æˆ·ä¸å­˜åœ¨"),
    
    /**
     * å•†å“ä¸å­˜åœ¨
     */
    PRODUCT_NOT_FOUND(5201, "å•†å“ä¸å­˜åœ¨"),
    
    // ========== ç³»ç»Ÿé”™è¯¯ (9xxx) ==========
    
    /**
     * ç³»ç»Ÿé”™è¯¯
     */
    SYSTEM_ERROR(9999, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•"),
    
    /**
     * æ•°æ®åº“é”™è¯¯
     */
    DATABASE_ERROR(9001, "æ•°æ®åº“é”™è¯¯"),
    
    /**
     * ç¼“å­˜é”™è¯¯
     */
    REDIS_ERROR(9002, "ç¼“å­˜é”™è¯¯"),
    
    /**
     * æ¶ˆæ¯é˜Ÿåˆ—é”™è¯¯
     */
    MQ_ERROR(9003, "æ¶ˆæ¯é˜Ÿåˆ—é”™è¯¯");
    
    /**
     * é”™è¯¯ç 
     */
    private final Integer code;
    
    /**
     * é”™è¯¯æ¶ˆæ¯
     */
    private final String message;
}
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šå¼‚å¸¸å±‚ï¼ˆExceptionï¼‰

### BusinessException.java

```java
package com.demo.order.exception;

import com.demo.order.enums.ErrorCode;
import lombok.Getter;

/**
 * ä¸šåŠ¡å¼‚å¸¸åŸºç±»
 * <p>
 * æ‰€æœ‰ä¸šåŠ¡å¼‚å¸¸éƒ½åº”ç»§æ‰¿æ­¤ç±»
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Getter
public class BusinessException extends RuntimeException {
    
    /**
     * é”™è¯¯ç 
     */
    private final ErrorCode errorCode;
    
    /**
     * æ„é€ å‡½æ•°
     *
     * @param errorCode é”™è¯¯ç 
     */
    public BusinessException(ErrorCode errorCode) {
        super(errorCode.getMessage());
        this.errorCode = errorCode;
    }
    
    /**
     * æ„é€ å‡½æ•°
     *
     * @param errorCode é”™è¯¯ç 
     * @param message é”™è¯¯æ¶ˆæ¯
     */
    public BusinessException(ErrorCode errorCode, String message) {
        super(message);
        this.errorCode = errorCode;
    }
    
    /**
     * æ„é€ å‡½æ•°
     *
     * @param errorCode é”™è¯¯ç 
     * @param cause åŸå§‹å¼‚å¸¸
     */
    public BusinessException(ErrorCode errorCode, Throwable cause) {
        super(errorCode.getMessage(), cause);
        this.errorCode = errorCode;
    }
    
    /**
     * æ„é€ å‡½æ•°
     *
     * @param errorCode é”™è¯¯ç 
     * @param message é”™è¯¯æ¶ˆæ¯
     * @param cause åŸå§‹å¼‚å¸¸
     */
    public BusinessException(ErrorCode errorCode, String message, Throwable cause) {
        super(message, cause);
        this.errorCode = errorCode;
    }
}
```

### OrderNotFoundException.java

```java
package com.demo.order.exception;

import com.demo.order.enums.ErrorCode;

/**
 * è®¢å•ä¸å­˜åœ¨å¼‚å¸¸
 *
 * @author zhangsan
 * @since 2025-01-01
 */
public class OrderNotFoundException extends BusinessException {
    
    /**
     * æ„é€ å‡½æ•°
     *
     * @param message é”™è¯¯æ¶ˆæ¯
     */
    public OrderNotFoundException(String message) {
        super(ErrorCode.ORDER_NOT_FOUND, message);
    }
}
```

### GlobalExceptionHandler.java

```java
package com.demo.order.exception;

import com.demo.order.common.ApiResponse;
import com.demo.order.enums.ErrorCode;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.validation.FieldError;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

import javax.servlet.http.HttpServletRequest;
import java.util.stream.Collectors;

/**
 * å…¨å±€å¼‚å¸¸å¤„ç†å™¨
 * <p>
 * ç»Ÿä¸€å¤„ç†ç³»ç»Ÿä¸­çš„æ‰€æœ‰å¼‚å¸¸ï¼Œè¿”å›ç»Ÿä¸€çš„å“åº”æ ¼å¼
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    /**
     * ä¸šåŠ¡å¼‚å¸¸
     */
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ApiResponse<Void>> handleBusinessException(
            BusinessException e, HttpServletRequest request) {
        
        log.warn("ä¸šåŠ¡å¼‚å¸¸: uri={}, code={}, message={}", 
                 request.getRequestURI(), 
                 e.getErrorCode().getCode(), 
                 e.getMessage());
        
        ApiResponse<Void> response = ApiResponse.error(
            e.getErrorCode().getCode(),
            e.getMessage()
        );
        
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(response);
    }
    
    /**
     * å‚æ•°æ ¡éªŒå¼‚å¸¸
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ApiResponse<Void>> handleValidationException(
            MethodArgumentNotValidException e, HttpServletRequest request) {
        
        String message = e.getBindingResult().getFieldErrors().stream()
            .map(error -> error.getField() + ": " + error.getDefaultMessage())
            .collect(Collectors.joining(", "));
        
        log.warn("å‚æ•°æ ¡éªŒå¤±è´¥: uri={}, message={}", request.getRequestURI(), message);
        
        ApiResponse<Void> response = ApiResponse.error(
            ErrorCode.PARAM_ERROR.getCode(),
            message
        );
        
        return ResponseEntity.badRequest().body(response);
    }
    
    /**
     * éæ³•å‚æ•°å¼‚å¸¸
     */
    @ExceptionHandler(IllegalArgumentException.class)
    public ResponseEntity<ApiResponse<Void>> handleIllegalArgumentException(
            IllegalArgumentException e, HttpServletRequest request) {
        
        log.warn("éæ³•å‚æ•°: uri={}, message={}", request.getRequestURI(), e.getMessage());
        
        ApiResponse<Void> response = ApiResponse.error(
            ErrorCode.PARAM_ERROR.getCode(),
            e.getMessage()
        );
        
        return ResponseEntity.badRequest().body(response);
    }
    
    /**
     * ç³»ç»Ÿå¼‚å¸¸
     */
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiResponse<Void>> handleException(
            Exception e, HttpServletRequest request) {
        
        log.error("ç³»ç»Ÿå¼‚å¸¸: uri={}, error={}", request.getRequestURI(), e.getMessage(), e);
        
        ApiResponse<Void> response = ApiResponse.error(
            ErrorCode.SYSTEM_ERROR.getCode(),
            ErrorCode.SYSTEM_ERROR.getMessage()
        );
        
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(response);
    }
}
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šå¸¸é‡å±‚ï¼ˆConstantï¼‰

### OrderConstants.java

```java
package com.demo.order.constant;

/**
 * è®¢å•å¸¸é‡
 * <p>
 * å®šä¹‰è®¢å•ç›¸å…³çš„æ‰€æœ‰å¸¸é‡
 *
 * @author zhangsan
 * @since 2025-01-01
 */
public final class OrderConstants {
    
    /**
     * ç§æœ‰æ„é€ å‡½æ•°ï¼ˆé˜²æ­¢å®ä¾‹åŒ–ï¼‰
     */
    private OrderConstants() {
        throw new UnsupportedOperationException("å¸¸é‡ç±»ä¸èƒ½å®ä¾‹åŒ–");
    }
    
    // ========== è®¢å•å· ==========
    
    /**
     * è®¢å•å·å‰ç¼€
     */
    public static final String ORDER_NO_PREFIX = "ORD";
    
    /**
     * è®¢å•å·é•¿åº¦
     */
    public static final int ORDER_NO_LENGTH = 20;
    
    // ========== ç¼“å­˜ ==========
    
    /**
     * è®¢å•ç¼“å­˜å‰ç¼€
     */
    public static final String CACHE_PREFIX = "order:";
    
    /**
     * è®¢å•ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
     */
    public static final long CACHE_EXPIRE_SECONDS = 600L;
    
    /**
     * è®¢å•åˆ—è¡¨ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
     */
    public static final long CACHE_LIST_EXPIRE_SECONDS = 300L;
    
    // ========== ä¸šåŠ¡é™åˆ¶ ==========
    
    /**
     * æœ€å°è´­ä¹°æ•°é‡
     */
    public static final int MIN_QUANTITY = 1;
    
    /**
     * æœ€å¤§è´­ä¹°æ•°é‡
     */
    public static final int MAX_QUANTITY = 999;
    
    /**
     * æœ€å°è®¢å•é‡‘é¢
     */
    public static final String MIN_AMOUNT = "0.01";
    
    /**
     * æœ€å¤§è®¢å•é‡‘é¢
     */
    public static final String MAX_AMOUNT = "999999.99";
    
    // ========== åˆ†é¡µ ==========
    
    /**
     * é»˜è®¤é¡µç 
     */
    public static final int DEFAULT_PAGE = 0;
    
    /**
     * é»˜è®¤æ¯é¡µå¤§å°
     */
    public static final int DEFAULT_SIZE = 10;
    
    /**
     * æœ€å¤§æ¯é¡µå¤§å°
     */
    public static final int MAX_SIZE = 100;
}
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šDTO å±‚ï¼ˆData Transfer Objectï¼‰

### OrderRequest.java

```java
package com.demo.order.dto;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.hibernate.validator.constraints.Length;

import javax.validation.constraints.*;
import java.math.BigDecimal;

/**
 * è®¢å•è¯·æ±‚ DTO
 * <p>
 * ç”¨äºæ¥æ”¶åˆ›å»ºè®¢å•çš„è¯·æ±‚å‚æ•°
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@ApiModel("è®¢å•è¯·æ±‚")
public class OrderRequest {
    
    /**
     * ç”¨æˆ·ID
     */
    @ApiModelProperty(value = "ç”¨æˆ·ID", required = true, example = "1001")
    @NotNull(message = "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º")
    @Positive(message = "ç”¨æˆ·IDå¿…é¡»å¤§äº0")
    private Long userId;
    
    /**
     * å•†å“ID
     */
    @ApiModelProperty(value = "å•†å“ID", required = true, example = "2001")
    @NotNull(message = "å•†å“IDä¸èƒ½ä¸ºç©º")
    @Positive(message = "å•†å“IDå¿…é¡»å¤§äº0")
    private Long productId;
    
    /**
     * å•†å“åç§°
     */
    @ApiModelProperty(value = "å•†å“åç§°", required = true, example = "iPhone 15 Pro")
    @NotBlank(message = "å•†å“åç§°ä¸èƒ½ä¸ºç©º")
    @Length(max = 100, message = "å•†å“åç§°é•¿åº¦ä¸èƒ½è¶…è¿‡100")
    private String productName;
    
    /**
     * è´­ä¹°æ•°é‡
     */
    @ApiModelProperty(value = "è´­ä¹°æ•°é‡", required = true, example = "2")
    @NotNull(message = "è´­ä¹°æ•°é‡ä¸èƒ½ä¸ºç©º")
    @Min(value = 1, message = "è´­ä¹°æ•°é‡è‡³å°‘ä¸º1")
    @Max(value = 999, message = "è´­ä¹°æ•°é‡ä¸èƒ½è¶…è¿‡999")
    private Integer quantity;
    
    /**
     * è®¢å•é‡‘é¢
     */
    @ApiModelProperty(value = "è®¢å•é‡‘é¢", required = true, example = "16998.00")
    @NotNull(message = "è®¢å•é‡‘é¢ä¸èƒ½ä¸ºç©º")
    @DecimalMin(value = "0.01", message = "è®¢å•é‡‘é¢å¿…é¡»å¤§äº0")
    @DecimalMax(value = "999999.99", message = "è®¢å•é‡‘é¢ä¸èƒ½è¶…è¿‡999999.99")
    @Digits(integer = 6, fraction = 2, message = "è®¢å•é‡‘é¢æ ¼å¼ä¸æ­£ç¡®")
    private BigDecimal totalAmount;
    
    /**
     * å¤‡æ³¨
     */
    @ApiModelProperty(value = "å¤‡æ³¨", example = "è¯·å°½å¿«å‘è´§")
    @Length(max = 500, message = "å¤‡æ³¨é•¿åº¦ä¸èƒ½è¶…è¿‡500")
    private String remark;
}
```

### OrderResponse.java

```java
package com.demo.order.dto;

import com.demo.order.entity.Order;
import com.demo.order.enums.OrderStatus;
import com.fasterxml.jackson.annotation.JsonFormat;
import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;
import java.time.LocalDateTime;

/**
 * è®¢å•å“åº” DTO
 * <p>
 * ç”¨äºè¿”å›è®¢å•åˆ›å»ºç»“æœ
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@ApiModel("è®¢å•å“åº”")
public class OrderResponse {
    
    /**
     * è®¢å•ID
     */
    @ApiModelProperty("è®¢å•ID")
    private Long orderId;
    
    /**
     * è®¢å•å·
     */
    @ApiModelProperty("è®¢å•å·")
    private String orderNo;
    
    /**
     * è®¢å•çŠ¶æ€
     */
    @ApiModelProperty("è®¢å•çŠ¶æ€")
    private OrderStatus status;
    
    /**
     * çŠ¶æ€æè¿°
     */
    @ApiModelProperty("çŠ¶æ€æè¿°")
    private String statusDesc;
    
    /**
     * è®¢å•é‡‘é¢
     */
    @ApiModelProperty("è®¢å•é‡‘é¢")
    private BigDecimal totalAmount;
    
    /**
     * åˆ›å»ºæ—¶é—´
     */
    @ApiModelProperty("åˆ›å»ºæ—¶é—´")
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime createTime;
    
    /**
     * ä» Entity è½¬æ¢ä¸º Response
     *
     * @param order è®¢å•å®ä½“
     * @return è®¢å•å“åº”
     */
    public static OrderResponse from(Order order) {
        return OrderResponse.builder()
            .orderId(order.getId())
            .orderNo(order.getOrderNo())
            .status(order.getStatus())
            .statusDesc(order.getStatus().getDescription())
            .totalAmount(order.getTotalAmount())
            .createTime(order.getCreateTime())
            .build();
    }
}
```

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šRepository å±‚

### OrderRepository.java

```java
package com.demo.order.repository;

import com.demo.order.entity.Order;
import com.demo.order.enums.OrderStatus;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.List;
import java.util.Optional;

/**
 * è®¢å•æ•°æ®è®¿é—®å±‚
 * <p>
 * è´Ÿè´£è®¢å•æ•°æ®çš„æŒä¹…åŒ–æ“ä½œ
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Repository
public interface OrderRepository extends JpaRepository<Order, Long> {
    
    /**
     * æ ¹æ®è®¢å•å·æŸ¥è¯¢è®¢å•
     *
     * @param orderNo è®¢å•å·
     * @return è®¢å•
     */
    Optional<Order> findByOrderNo(String orderNo);
    
    /**
     * æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢è®¢å•åˆ—è¡¨
     *
     * @param userId ç”¨æˆ·ID
     * @return è®¢å•åˆ—è¡¨
     */
    List<Order> findByUserId(Long userId);
    
    /**
     * æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢è®¢å•åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
     *
     * @param userId ç”¨æˆ·ID
     * @param pageable åˆ†é¡µå‚æ•°
     * @return è®¢å•åˆ†é¡µ
     */
    Page<Order> findByUserId(Long userId, Pageable pageable);
    
    /**
     * æ ¹æ®ç”¨æˆ·IDå’ŒçŠ¶æ€æŸ¥è¯¢è®¢å•
     *
     * @param userId ç”¨æˆ·ID
     * @param status è®¢å•çŠ¶æ€
     * @return è®¢å•åˆ—è¡¨
     */
    List<Order> findByUserIdAndStatus(Long userId, OrderStatus status);
    
    /**
     * æ ¹æ®ç”¨æˆ·IDå’Œåˆ›å»ºæ—¶é—´èŒƒå›´æŸ¥è¯¢è®¢å•
     *
     * @param userId ç”¨æˆ·ID
     * @param startTime å¼€å§‹æ—¶é—´
     * @param endTime ç»“æŸæ—¶é—´
     * @return è®¢å•åˆ—è¡¨
     */
    List<Order> findByUserIdAndCreateTimeBetween(
        Long userId, LocalDateTime startTime, LocalDateTime endTime
    );
    
    /**
     * ç»Ÿè®¡ç”¨æˆ·è®¢å•æ•°é‡
     *
     * @param userId ç”¨æˆ·ID
     * @return è®¢å•æ•°é‡
     */
    long countByUserId(Long userId);
    
    /**
     * ç»Ÿè®¡ç”¨æˆ·æŒ‡å®šçŠ¶æ€çš„è®¢å•æ•°é‡
     *
     * @param userId ç”¨æˆ·ID
     * @param status è®¢å•çŠ¶æ€
     * @return è®¢å•æ•°é‡
     */
    long countByUserIdAndStatus(Long userId, OrderStatus status);
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·é«˜ä»·å€¼è®¢å•ï¼ˆè‡ªå®šä¹‰SQLï¼‰
     *
     * @param userId ç”¨æˆ·ID
     * @param minAmount æœ€å°é‡‘é¢
     * @return è®¢å•åˆ—è¡¨
     */
    @Query("SELECT o FROM Order o WHERE o.userId = :userId " +
           "AND o.totalAmount >= :minAmount " +
           "ORDER BY o.totalAmount DESC")
    List<Order> findHighValueOrders(@Param("userId") Long userId, 
                                   @Param("minAmount") BigDecimal minAmount);
    
    /**
     * æŸ¥è¯¢æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„è®¢å•æ€»é‡‘é¢
     *
     * @param startTime å¼€å§‹æ—¶é—´
     * @param endTime ç»“æŸæ—¶é—´
     * @return æ€»é‡‘é¢
     */
    @Query("SELECT COALESCE(SUM(o.totalAmount), 0) FROM Order o " +
           "WHERE o.createTime >= :startTime AND o.createTime < :endTime " +
           "AND o.status != 'CANCELLED'")
    BigDecimal sumAmountBetween(@Param("startTime") LocalDateTime startTime,
                               @Param("endTime") LocalDateTime endTime);
}
```

---

## ç¬¬å…«éƒ¨åˆ†ï¼šService å±‚

### OrderService.javaï¼ˆæ¥å£ï¼‰

```java
package com.demo.order.service;

import com.demo.order.dto.OrderRequest;
import com.demo.order.dto.OrderResponse;
import com.demo.order.entity.Order;
import com.demo.order.enums.OrderStatus;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;

import java.util.List;

/**
 * è®¢å•æœåŠ¡æ¥å£
 * <p>
 * å®šä¹‰è®¢å•ç›¸å…³çš„æ‰€æœ‰ä¸šåŠ¡æ“ä½œ
 *
 * @author zhangsan
 * @since 2025-01-01
 */
public interface OrderService {
    
    /**
     * åˆ›å»ºè®¢å•
     *
     * @param request è®¢å•è¯·æ±‚
     * @return è®¢å•å“åº”
     */
    OrderResponse createOrder(OrderRequest request);
    
    /**
     * æ ¹æ®IDæŸ¥è¯¢è®¢å•
     *
     * @param orderId è®¢å•ID
     * @return è®¢å•
     */
    Order getOrderById(Long orderId);
    
    /**
     * æ ¹æ®è®¢å•å·æŸ¥è¯¢è®¢å•
     *
     * @param orderNo è®¢å•å·
     * @return è®¢å•
     */
    Order getOrderByOrderNo(String orderNo);
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
     *
     * @param userId ç”¨æˆ·ID
     * @param pageable åˆ†é¡µå‚æ•°
     * @return è®¢å•åˆ†é¡µ
     */
    Page<Order> listUserOrders(Long userId, Pageable pageable);
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·æŒ‡å®šçŠ¶æ€çš„è®¢å•
     *
     * @param userId ç”¨æˆ·ID
     * @param status è®¢å•çŠ¶æ€
     * @return è®¢å•åˆ—è¡¨
     */
    List<Order> listUserOrdersByStatus(Long userId, OrderStatus status);
    
    /**
     * å–æ¶ˆè®¢å•
     *
     * @param orderId è®¢å•ID
     */
    void cancelOrder(Long orderId);
    
    /**
     * æ”¯ä»˜è®¢å•
     *
     * @param orderId è®¢å•ID
     */
    void payOrder(Long orderId);
    
    /**
     * å®Œæˆè®¢å•
     *
     * @param orderId è®¢å•ID
     */
    void completeOrder(Long orderId);
}
```

### OrderServiceImpl.javaï¼ˆå®ç°ï¼‰

```java
package com.demo.order.service.impl;

import com.demo.order.constant.OrderConstants;
import com.demo.order.dto.OrderRequest;
import com.demo.order.dto.OrderResponse;
import com.demo.order.entity.Order;
import com.demo.order.enums.ErrorCode;
import com.demo.order.enums.OrderStatus;
import com.demo.order.exception.BusinessException;
import com.demo.order.exception.OrderNotFoundException;
import com.demo.order.factory.OrderFactory;
import com.demo.order.repository.OrderRepository;
import com.demo.order.service.OrderService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.Assert;

import java.time.LocalDateTime;
import java.util.List;

/**
 * è®¢å•æœåŠ¡å®ç°
 * <p>
 * å®ç°è®¢å•ç›¸å…³çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Service
@Slf4j
public class OrderServiceImpl implements OrderService {
    
    @Autowired
    private OrderRepository orderRepository;
    
    @Autowired
    private OrderFactory orderFactory;
    
    /**
     * åˆ›å»ºè®¢å•
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public OrderResponse createOrder(OrderRequest request) {
        log.info("åˆ›å»ºè®¢å•å¼€å§‹, userId={}, productId={}, quantity={}", 
                 request.getUserId(), request.getProductId(), request.getQuantity());
        
        // 1. å‚æ•°æ ¡éªŒ
        validateRequest(request);
        
        // 2. åˆ›å»ºè®¢å•
        Order order = orderFactory.create(request);
        
        // 3. ä¿å­˜è®¢å•
        orderRepository.save(order);
        
        log.info("è®¢å•åˆ›å»ºæˆåŠŸ, orderNo={}, orderId={}", 
                 order.getOrderNo(), order.getId());
        
        // 4. è¿”å›ç»“æœ
        return OrderResponse.from(order);
    }
    
    /**
     * æŸ¥è¯¢è®¢å•
     */
    @Override
    public Order getOrderById(Long orderId) {
        Assert.notNull(orderId, "è®¢å•IDä¸èƒ½ä¸ºç©º");
        
        log.debug("æŸ¥è¯¢è®¢å•, orderId={}", orderId);
        
        return orderRepository.findById(orderId)
            .orElseThrow(() -> new OrderNotFoundException("è®¢å•ä¸å­˜åœ¨: " + orderId));
    }
    
    /**
     * æ ¹æ®è®¢å•å·æŸ¥è¯¢
     */
    @Override
    public Order getOrderByOrderNo(String orderNo) {
        Assert.hasText(orderNo, "è®¢å•å·ä¸èƒ½ä¸ºç©º");
        
        log.debug("æŸ¥è¯¢è®¢å•, orderNo={}", orderNo);
        
        return orderRepository.findByOrderNo(orderNo)
            .orElseThrow(() -> new OrderNotFoundException("è®¢å•ä¸å­˜åœ¨: " + orderNo));
    }
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨
     */
    @Override
    public Page<Order> listUserOrders(Long userId, Pageable pageable) {
        Assert.notNull(userId, "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
        Assert.notNull(pageable, "åˆ†é¡µå‚æ•°ä¸èƒ½ä¸ºç©º");
        
        log.debug("æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨, userId={}, page={}, size={}", 
                  userId, pageable.getPageNumber(), pageable.getPageSize());
        
        return orderRepository.findByUserId(userId, pageable);
    }
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·æŒ‡å®šçŠ¶æ€çš„è®¢å•
     */
    @Override
    public List<Order> listUserOrdersByStatus(Long userId, OrderStatus status) {
        Assert.notNull(userId, "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
        Assert.notNull(status, "è®¢å•çŠ¶æ€ä¸èƒ½ä¸ºç©º");
        
        log.debug("æŸ¥è¯¢ç”¨æˆ·è®¢å•, userId={}, status={}", userId, status);
        
        return orderRepository.findByUserIdAndStatus(userId, status);
    }
    
    /**
     * å–æ¶ˆè®¢å•
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public void cancelOrder(Long orderId) {
        log.info("å–æ¶ˆè®¢å•, orderId={}", orderId);
        
        // 1. æŸ¥è¯¢è®¢å•
        Order order = getOrderById(orderId);
        
        // 2. æ£€æŸ¥è®¢å•çŠ¶æ€
        if (!order.getStatus().canCancel()) {
            throw new BusinessException(ErrorCode.ORDER_CANNOT_CANCEL, 
                                      String.format("è®¢å•çŠ¶æ€[%s]ä¸å…è®¸å–æ¶ˆ", 
                                                   order.getStatus().getDescription()));
        }
        
        // 3. æ›´æ–°è®¢å•çŠ¶æ€
        order.setStatus(OrderStatus.CANCELLED);
        order.setUpdateTime(LocalDateTime.now());
        orderRepository.save(order);
        
        log.info("è®¢å•å–æ¶ˆæˆåŠŸ, orderNo={}", order.getOrderNo());
    }
    
    /**
     * æ”¯ä»˜è®¢å•
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public void payOrder(Long orderId) {
        log.info("æ”¯ä»˜è®¢å•, orderId={}", orderId);
        
        // 1. æŸ¥è¯¢è®¢å•
        Order order = getOrderById(orderId);
        
        // 2. æ£€æŸ¥è®¢å•çŠ¶æ€
        if (order.getStatus() != OrderStatus.PENDING) {
            throw new BusinessException(ErrorCode.ORDER_STATUS_ERROR, 
                                      String.format("è®¢å•çŠ¶æ€[%s]ä¸å…è®¸æ”¯ä»˜", 
                                                   order.getStatus().getDescription()));
        }
        
        // 3. æ›´æ–°è®¢å•çŠ¶æ€
        order.setStatus(OrderStatus.PAID);
        order.setUpdateTime(LocalDateTime.now());
        orderRepository.save(order);
        
        log.info("è®¢å•æ”¯ä»˜æˆåŠŸ, orderNo={}", order.getOrderNo());
    }
    
    /**
     * å®Œæˆè®¢å•
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public void completeOrder(Long orderId) {
        log.info("å®Œæˆè®¢å•, orderId={}", orderId);
        
        // 1. æŸ¥è¯¢è®¢å•
        Order order = getOrderById(orderId);
        
        // 2. æ£€æŸ¥è®¢å•çŠ¶æ€
        if (order.getStatus() != OrderStatus.SHIPPED) {
            throw new BusinessException(ErrorCode.ORDER_STATUS_ERROR, 
                                      String.format("è®¢å•çŠ¶æ€[%s]ä¸å…è®¸å®Œæˆ", 
                                                   order.getStatus().getDescription()));
        }
        
        // 3. æ›´æ–°è®¢å•çŠ¶æ€
        order.setStatus(OrderStatus.COMPLETED);
        order.setUpdateTime(LocalDateTime.now());
        orderRepository.save(order);
        
        log.info("è®¢å•å®Œæˆ, orderNo={}", order.getOrderNo());
    }
    
    /**
     * æ ¡éªŒè¯·æ±‚å‚æ•°
     */
    private void validateRequest(OrderRequest request) {
        Assert.notNull(request, "è¯·æ±‚å‚æ•°ä¸èƒ½ä¸ºç©º");
        Assert.notNull(request.getUserId(), "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
        Assert.notNull(request.getProductId(), "å•†å“IDä¸èƒ½ä¸ºç©º");
        Assert.notNull(request.getQuantity(), "è´­ä¹°æ•°é‡ä¸èƒ½ä¸ºç©º");
        Assert.notNull(request.getTotalAmount(), "è®¢å•é‡‘é¢ä¸èƒ½ä¸ºç©º");
        
        Assert.isTrue(request.getQuantity() >= OrderConstants.MIN_QUANTITY 
                   && request.getQuantity() <= OrderConstants.MAX_QUANTITY,
                   String.format("è´­ä¹°æ•°é‡å¿…é¡»åœ¨%d-%dä¹‹é—´", 
                                OrderConstants.MIN_QUANTITY, 
                                OrderConstants.MAX_QUANTITY));
    }
}
```

---

## ç¬¬ä¹éƒ¨åˆ†ï¼šController å±‚

### OrderController.java

```java
package com.demo.order.controller;

import com.demo.order.common.ApiResponse;
import com.demo.order.constant.OrderConstants;
import com.demo.order.dto.OrderRequest;
import com.demo.order.dto.OrderResponse;
import com.demo.order.entity.Order;
import com.demo.order.service.OrderService;
import com.demo.order.vo.OrderVO;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;
import javax.validation.constraints.*;

/**
 * è®¢å•æ§åˆ¶å™¨
 * <p>
 * æä¾›è®¢å•ç›¸å…³çš„ REST API
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@RestController
@RequestMapping("/api/orders")
@Slf4j
@Api(tags = "è®¢å•ç®¡ç†")
public class OrderController {
    
    @Autowired
    private OrderService orderService;
    
    /**
     * åˆ›å»ºè®¢å•
     */
    @PostMapping
    @ApiOperation("åˆ›å»ºè®¢å•")
    public ApiResponse<OrderResponse> createOrder(
            @Valid @RequestBody OrderRequest request) {
        
        log.info("åˆ›å»ºè®¢å•è¯·æ±‚: userId={}, productId={}, quantity={}", 
                 request.getUserId(), request.getProductId(), request.getQuantity());
        
        OrderResponse response = orderService.createOrder(request);
        
        return ApiResponse.success(response);
    }
    
    /**
     * æŸ¥è¯¢è®¢å•è¯¦æƒ…
     */
    @GetMapping("/{orderId}")
    @ApiOperation("æŸ¥è¯¢è®¢å•è¯¦æƒ…")
    public ApiResponse<OrderVO> getOrder(
            @PathVariable @NotNull @Positive Long orderId) {
        
        log.info("æŸ¥è¯¢è®¢å•: orderId={}", orderId);
        
        Order order = orderService.getOrderById(orderId);
        OrderVO vo = OrderVO.from(order);
        
        return ApiResponse.success(vo);
    }
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨
     */
    @GetMapping("/user/{userId}")
    @ApiOperation("æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨")
    public ApiResponse<Page<OrderVO>> listUserOrders(
            @PathVariable @NotNull @Positive Long userId,
            @RequestParam(defaultValue = "0") @Min(0) Integer page,
            @RequestParam(defaultValue = "10") @Min(1) @Max(100) Integer size) {
        
        log.info("æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨: userId={}, page={}, size={}", userId, page, size);
        
        Pageable pageable = PageRequest.of(
            page, 
            size, 
            Sort.by("createTime").descending()
        );
        
        Page<Order> orderPage = orderService.listUserOrders(userId, pageable);
        Page<OrderVO> voPage = orderPage.map(OrderVO::from);
        
        return ApiResponse.success(voPage);
    }
    
    /**
     * å–æ¶ˆè®¢å•
     */
    @DeleteMapping("/{orderId}")
    @ApiOperation("å–æ¶ˆè®¢å•")
    public ApiResponse<Void> cancelOrder(
            @PathVariable @NotNull @Positive Long orderId) {
        
        log.info("å–æ¶ˆè®¢å•: orderId={}", orderId);
        
        orderService.cancelOrder(orderId);
        
        return ApiResponse.success();
    }
    
    /**
     * æ”¯ä»˜è®¢å•
     */
    @PutMapping("/{orderId}/pay")
    @ApiOperation("æ”¯ä»˜è®¢å•")
    public ApiResponse<Void> payOrder(
            @PathVariable @NotNull @Positive Long orderId) {
        
        log.info("æ”¯ä»˜è®¢å•: orderId={}", orderId);
        
        orderService.payOrder(orderId);
        
        return ApiResponse.success();
    }
    
    /**
     * å®Œæˆè®¢å•
     */
    @PutMapping("/{orderId}/complete")
    @ApiOperation("å®Œæˆè®¢å•")
    public ApiResponse<Void> completeOrder(
            @PathVariable @NotNull @Positive Long orderId) {
        
        log.info("å®Œæˆè®¢å•: orderId={}", orderId);
        
        orderService.completeOrder(orderId);
        
        return ApiResponse.success();
    }
}
```

---

## æ€»ç»“

æœ¬è§„èŒƒåŒ–ä»£ç ç¤ºä¾‹å±•ç¤ºäº†ï¼š

### âœ… å®Œæ•´çš„åˆ†å±‚æ¶æ„
- Entityï¼ˆå®ä½“å±‚ï¼‰
- Enumï¼ˆæšä¸¾å±‚ï¼‰
- Exceptionï¼ˆå¼‚å¸¸å±‚ï¼‰
- Constantï¼ˆå¸¸é‡å±‚ï¼‰
- DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰
- Repositoryï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰
- Serviceï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰
- Controllerï¼ˆæ§åˆ¶å™¨å±‚ï¼‰

### âœ… ç¬¦åˆæ‰€æœ‰è§„èŒƒ
- å‘½åè§„èŒƒ âœ…
- ä»£ç æ ¼å¼è§„èŒƒ âœ…
- æ³¨é‡Šè§„èŒƒ âœ…
- æ—¥å¿—è§„èŒƒ âœ…
- å¼‚å¸¸å¤„ç†è§„èŒƒ âœ…
- å‚æ•°æ ¡éªŒè§„èŒƒ âœ…

### âœ… ä»£ç è´¨é‡
- èŒè´£å•ä¸€ âœ…
- é«˜å†…èšä½è€¦åˆ âœ…
- æ˜“äºæµ‹è¯• âœ…
- æ˜“äºç»´æŠ¤ âœ…
- å¯æ‰©å±•æ€§å¼º âœ…

---

**æŒ‰ç…§æ­¤ç¤ºä¾‹é‡æ„ä½ çš„é¡¹ç›®ï¼Œä»£ç è´¨é‡å°†æå‡ä¸€ä¸ªæ¡£æ¬¡ï¼ğŸš€**

