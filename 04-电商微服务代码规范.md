# ç”µå•†å¾®æœåŠ¡ä»£ç è§„èŒƒ
## å›¢é˜Ÿç»Ÿä¸€ç¼–ç æ ‡å‡†

---

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

**é€‚ç”¨èŒƒå›´**ï¼š
- ç”µå•†å¾®æœåŠ¡é¡¹ç›®æ‰€æœ‰æ¨¡å—
- Java 8+ å¼€å‘ç¯å¢ƒ
- Spring Boot 2.7+ / Spring Cloud

**å¼ºåˆ¶ç­‰çº§**ï¼š
- ğŸ”´ **å¼ºåˆ¶**ï¼šå¿…é¡»éµå®ˆï¼Œè¿åä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯æˆ–ä¸¥é‡é—®é¢˜
- ğŸŸ¡ **æ¨è**ï¼šå»ºè®®éµå®ˆï¼Œæé«˜ä»£ç è´¨é‡
- ğŸŸ¢ **å‚è€ƒ**ï¼šå¯é€‰ï¼Œæ ¹æ®å®é™…æƒ…å†µå†³å®š

---

## ç¬¬ä¸€ç« ï¼šå‘½åè§„èŒƒ

### 1.1 åŒ…å

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```
æ ¼å¼ï¼šå…¨éƒ¨å°å†™ï¼Œä½¿ç”¨ç‚¹å·åˆ†éš”
è§„åˆ™ï¼šcom.{å…¬å¸}.{é¡¹ç›®}.{æ¨¡å—}.{åŠŸèƒ½}

ç¤ºä¾‹ï¼š
com.demo.order.controller     // æ§åˆ¶å™¨
com.demo.order.service        // æœåŠ¡å±‚
com.demo.order.repository     // æ•°æ®è®¿é—®å±‚
com.demo.order.entity         // å®ä½“ç±»
com.demo.order.dto            // æ•°æ®ä¼ è¾“å¯¹è±¡
com.demo.order.vo             // è§†å›¾å¯¹è±¡
com.demo.order.enums          // æšä¸¾ç±»
com.demo.order.exception      // å¼‚å¸¸ç±»
com.demo.order.config         // é…ç½®ç±»
com.demo.order.constant       // å¸¸é‡ç±»
com.demo.order.util           // å·¥å…·ç±»
```

### 1.2 ç±»å

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```
æ ¼å¼ï¼šUpperCamelCaseï¼ˆå¤§é©¼å³°ï¼‰
è§„åˆ™ï¼š
  - å®ä½“ç±»ï¼šåè¯ï¼Œå¦‚ Orderã€Userã€Product
  - Service ç±»ï¼šåè¯ + Serviceï¼Œå¦‚ OrderService
  - Controller ç±»ï¼šåè¯ + Controllerï¼Œå¦‚ OrderController
  - Repository ç±»ï¼šåè¯ + Repositoryï¼Œå¦‚ OrderRepository
  - DTO ç±»ï¼šåè¯ + Request/Responseï¼Œå¦‚ OrderRequest
  - VO ç±»ï¼šåè¯ + VOï¼Œå¦‚ OrderVO
  - æšä¸¾ç±»ï¼šåè¯ï¼Œå¦‚ OrderStatus
  - å¼‚å¸¸ç±»ï¼šåè¯ + Exceptionï¼Œå¦‚ OrderNotFoundException
  - é…ç½®ç±»ï¼šåè¯ + Configï¼Œå¦‚ RedisConfig
  - å·¥å…·ç±»ï¼šåè¯ + Util/Helper/Utilsï¼Œå¦‚ DateUtil

ç¤ºä¾‹ï¼š
âœ… æ­£ç¡®ï¼š
  public class OrderService { }
  public class OrderController { }
  public class UserRepository { }
  public class OrderRequest { }
  public class OrderVO { }

âŒ é”™è¯¯ï¼š
  public class orderservice { }      // å°å†™
  public class Order_Service { }     // ä¸‹åˆ’çº¿
  public class IOrderService { }     // I å‰ç¼€ï¼ˆJava ä¸æ¨èï¼‰
```

### 1.3 æ–¹æ³•å

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```
æ ¼å¼ï¼šlowerCamelCaseï¼ˆå°é©¼å³°ï¼‰
è§„åˆ™ï¼š
  - åŠ¨è¯å¼€å¤´ï¼Œè¡¨ç¤ºè¡Œä¸º
  - è·å–å•ä¸ªå¯¹è±¡ï¼šget + åè¯ï¼Œå¦‚ getOrderById
  - è·å–åˆ—è¡¨ï¼šlist/query + åè¯ï¼Œå¦‚ listOrders
  - æŸ¥è¯¢æ•°é‡ï¼šcount + åè¯ï¼Œå¦‚ countOrders
  - æ–°å¢ï¼šcreate/add/saveï¼Œå¦‚ createOrder
  - ä¿®æ”¹ï¼šupdate/modifyï¼Œå¦‚ updateOrder
  - åˆ é™¤ï¼šdelete/removeï¼Œå¦‚ deleteOrder
  - åˆ¤æ–­ï¼šis/has/canï¼Œå¦‚ isActiveã€hasPermission

ç¤ºä¾‹ï¼š
âœ… æ­£ç¡®ï¼š
  public Order getOrderById(Long orderId) { }
  public List<Order> listOrdersByUserId(Long userId) { }
  public void createOrder(OrderRequest request) { }
  public void updateOrder(Order order) { }
  public void deleteOrder(Long orderId) { }
  public boolean isActive() { }
  public boolean hasStock() { }

âŒ é”™è¯¯ï¼š
  public Order GetOrderById(Long orderId) { }        // å¤§å†™å¼€å¤´
  public Order get_order_by_id(Long orderId) { }    // ä¸‹åˆ’çº¿
  public Order order(Long orderId) { }              // ä¸æ˜¯åŠ¨è¯
```

### 1.4 å˜é‡å

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```
æ ¼å¼ï¼šlowerCamelCaseï¼ˆå°é©¼å³°ï¼‰
è§„åˆ™ï¼š
  - è§åçŸ¥ä¹‰ï¼Œé¿å…å•å­—æ¯ï¼ˆé™¤å¾ªç¯å˜é‡ï¼‰
  - å¸ƒå°”ç±»å‹ï¼šis/has/can å¼€å¤´
  - é›†åˆç±»å‹ï¼šå¤æ•°å½¢å¼æˆ–åŠ  List/Map åç¼€
  - ä¸è¦ç”¨æ‹¼éŸ³

ç¤ºä¾‹ï¼š
âœ… æ­£ç¡®ï¼š
  private Long userId;
  private String userName;
  private boolean isActive;
  private boolean hasStock;
  private List<Order> orderList;
  private Map<Long, Order> orderMap;

âŒ é”™è¯¯ï¼š
  private Long yonghuId;           // æ‹¼éŸ³
  private String s;                // æ— æ„ä¹‰
  private boolean active;          // å¸ƒå°”ç±»å‹åº”åŠ  is
  private List<Order> order;       // åº”è¯¥æ˜¯å¤æ•°
```

### 1.5 å¸¸é‡å

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```
æ ¼å¼ï¼šUPPER_CASEï¼ˆå…¨å¤§å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”ï¼‰
è§„åˆ™ï¼š
  - å¿…é¡»ç”¨ static final ä¿®é¥°
  - æ”¾åœ¨ç±»çš„æœ€å‰é¢

ç¤ºä¾‹ï¼š
âœ… æ­£ç¡®ï¼š
  public static final String ORDER_PREFIX = "ORD";
  public static final int MAX_RETRY_COUNT = 3;
  public static final long CACHE_EXPIRE_SECONDS = 600L;

âŒ é”™è¯¯ï¼š
  public static final String orderPrefix = "ORD";    // å°å†™
  public static final String order_prefix = "ORD";   // æ··åˆ
```

### 1.6 æšä¸¾å

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```
æšä¸¾ç±»ï¼šUpperCamelCaseï¼ˆå¤§é©¼å³°ï¼‰
æšä¸¾å€¼ï¼šUPPER_CASEï¼ˆå…¨å¤§å†™ï¼‰

ç¤ºä¾‹ï¼š
âœ… æ­£ç¡®ï¼š
  public enum OrderStatus {
      PENDING,
      PAID,
      PROCESSING,
      SHIPPED,
      COMPLETED,
      CANCELLED
  }

âŒ é”™è¯¯ï¼š
  public enum orderStatus {           // å°å†™
      pending,                        // å°å†™
      Paid                           // å¤§é©¼å³°
  }
```

---

## ç¬¬äºŒç« ï¼šä»£ç æ ¼å¼

### 2.1 ç¼©è¿›

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```
- ä½¿ç”¨ 4 ä¸ªç©ºæ ¼ç¼©è¿›ï¼ˆä¸ç”¨ Tabï¼‰
- IDE ç»Ÿä¸€é…ç½®ï¼šPreferences â†’ Editor â†’ Code Style â†’ Java â†’ Tabs and Indents
```

### 2.2 æ¯è¡Œé•¿åº¦

**è§„èŒƒ**ï¼šğŸŸ¡ **æ¨è**

```
- å•è¡Œä¸è¶…è¿‡ 120 ä¸ªå­—ç¬¦
- è¶…è¿‡åˆ™æ¢è¡Œ
```

### 2.3 ç©ºè¡Œ

**è§„èŒƒ**ï¼šğŸŸ¡ **æ¨è**

```java
public class OrderService {
    
    @Autowired
    private OrderRepository orderRepository;  // å­—æ®µåç©ºä¸€è¡Œ
    
    @Autowired
    private InventoryService inventoryService;
    
    // å­—æ®µå’Œæ–¹æ³•ä¹‹é—´ç©ºä¸€è¡Œ
    
    /**
     * åˆ›å»ºè®¢å•
     */
    public Order createOrder(OrderRequest request) {  // æ–¹æ³•ä¹‹é—´ç©ºä¸€è¡Œ
        // æ–¹æ³•å†…éƒ¨é€»è¾‘åˆ†ç»„ï¼Œç»„ä¹‹é—´ç©ºä¸€è¡Œ
        
        // 1. å‚æ•°æ ¡éªŒ
        validateRequest(request);
        
        // 2. åˆ›å»ºè®¢å•ï¼ˆä¸åŒé€»è¾‘å—ä¹‹é—´ç©ºä¸€è¡Œï¼‰
        Order order = buildOrder(request);
        
        // 3. ä¿å­˜è®¢å•
        return orderRepository.save(order);
    }
    
    /**
     * æŸ¥è¯¢è®¢å•
     */
    public Order getOrderById(Long orderId) {
        // ...
    }
}
```

### 2.4 å¤§æ‹¬å·

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
// âœ… æ­£ç¡®ï¼šK&R é£æ ¼ï¼ˆå·¦å¤§æ‹¬å·ä¸æ¢è¡Œï¼‰
if (condition) {
    // ...
}

if (condition) {
    // ...
} else {
    // ...
}

// âŒ é”™è¯¯ï¼šå¤§æ‹¬å·æ¢è¡Œ
if (condition) 
{
    // ...
}

// ğŸ”´ å¼ºåˆ¶ï¼šå³ä½¿åªæœ‰ä¸€è¡Œä¹Ÿè¦åŠ å¤§æ‹¬å·
if (condition) {
    doSomething();
}

// âŒ é”™è¯¯ï¼šä¸åŠ å¤§æ‹¬å·
if (condition)
    doSomething();
```

---

## ç¬¬ä¸‰ç« ï¼šæ³¨é‡Šè§„èŒƒ

### 3.1 ç±»æ³¨é‡Š

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
/**
 * è®¢å•æœåŠ¡
 * <p>
 * è´Ÿè´£è®¢å•çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œ
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Service
@Slf4j
public class OrderService {
    // ...
}
```

### 3.2 æ–¹æ³•æ³¨é‡Š

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**ï¼ˆå…¬å…±æ–¹æ³•å¿…é¡»æ³¨é‡Šï¼‰

```java
/**
 * åˆ›å»ºè®¢å•
 * <p>
 * 1. æ ¡éªŒå‚æ•°
 * 2. æ£€æŸ¥åº“å­˜
 * 3. åˆ›å»ºè®¢å•
 * 4. å‘é€æ¶ˆæ¯
 *
 * @param request è®¢å•è¯·æ±‚
 * @return è®¢å•å“åº”
 * @throws BusinessException ä¸šåŠ¡å¼‚å¸¸
 */
@Transactional(rollbackFor = Exception.class)
public OrderResponse createOrder(OrderRequest request) {
    // ...
}
```

### 3.3 å­—æ®µæ³¨é‡Š

**è§„èŒƒ**ï¼šğŸŸ¡ **æ¨è**

```java
@Data
@Entity
@Table(name = "t_order")
public class Order {
    
    /**
     * ä¸»é”®ID
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    /**
     * è®¢å•å·ï¼ˆå”¯ä¸€ï¼‰
     */
    @Column(unique = true, nullable = false, length = 64)
    private String orderNo;
    
    /**
     * ç”¨æˆ·ID
     */
    @Column(nullable = false)
    private Long userId;
    
    /**
     * è®¢å•çŠ¶æ€
     * @see OrderStatus
     */
    @Enumerated(EnumType.STRING)
    @Column(nullable = false, length = 20)
    private OrderStatus status;
}
```

### 3.4 æšä¸¾æ³¨é‡Š

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
/**
 * è®¢å•çŠ¶æ€æšä¸¾
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Getter
@AllArgsConstructor
public enum OrderStatus {
    
    /**
     * å¾…æ”¯ä»˜
     */
    PENDING("å¾…æ”¯ä»˜", 0),
    
    /**
     * å·²æ”¯ä»˜
     */
    PAID("å·²æ”¯ä»˜", 1),
    
    /**
     * å¤„ç†ä¸­
     */
    PROCESSING("å¤„ç†ä¸­", 2),
    
    /**
     * å·²å‘è´§
     */
    SHIPPED("å·²å‘è´§", 3),
    
    /**
     * å·²å®Œæˆ
     */
    COMPLETED("å·²å®Œæˆ", 4),
    
    /**
     * å·²å–æ¶ˆ
     */
    CANCELLED("å·²å–æ¶ˆ", -1);
    
    /**
     * çŠ¶æ€æè¿°
     */
    private final String description;
    
    /**
     * çŠ¶æ€ç 
     */
    private final Integer code;
}
```

### 3.5 è¡Œå†…æ³¨é‡Š

**è§„èŒƒ**ï¼šğŸŸ¡ **æ¨è**

```java
public void processOrder(Order order) {
    // 1. å‚æ•°æ ¡éªŒ
    validateOrder(order);
    
    // 2. æ‰£å‡åº“å­˜
    inventoryService.deduct(order.getProductId(), order.getQuantity());
    
    // 3. æ›´æ–°è®¢å•çŠ¶æ€
    order.setStatus(OrderStatus.PROCESSING);
    orderRepository.save(order);
    
    // TODO: å‘é€é€šçŸ¥ï¼ˆå¾…å®ç°ï¼‰
    // FIXME: åº“å­˜æ‰£å‡å¤±è´¥æ—¶éœ€è¦å›æ»šè®¢å•ï¼ˆBUGï¼‰
}
```

---

## ç¬¬å››ç« ï¼šæ—¥å¿—è§„èŒƒ

### 4.1 æ—¥å¿—çº§åˆ«

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
@Service
@Slf4j
public class OrderService {
    
    public Order createOrder(OrderRequest request) {
        // TRACE: ä¸ä½¿ç”¨ï¼ˆå¤ªè¯¦ç»†ï¼‰
        
        // DEBUG: è°ƒè¯•ä¿¡æ¯ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
        log.debug("è®¢å•è¯·æ±‚å‚æ•°: {}", JSON.toJSONString(request));
        
        // INFO: é‡è¦çš„ä¸šåŠ¡æµç¨‹ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
        log.info("åˆ›å»ºè®¢å•å¼€å§‹, userId={}, productId={}", 
                 request.getUserId(), request.getProductId());
        
        Order order = buildOrder(request);
        orderRepository.save(order);
        
        // INFO: å…³é”®æ“ä½œæˆåŠŸ
        log.info("è®¢å•åˆ›å»ºæˆåŠŸ, orderNo={}, orderId={}", 
                 order.getOrderNo(), order.getId());
        
        return order;
    }
    
    public void deductStock(Long productId, Integer quantity) {
        int stock = getStock(productId);
        
        // WARN: è­¦å‘Šï¼ˆä¸å½±å“æµç¨‹ï¼Œä½†éœ€è¦å…³æ³¨ï¼‰
        if (stock < 10) {
            log.warn("åº“å­˜ä¸è¶³ï¼Œå³å°†å”®ç½„, productId={}, stock={}", productId, stock);
        }
        
        if (stock < quantity) {
            // ERROR: é”™è¯¯ï¼ˆå½±å“ä¸šåŠ¡æµç¨‹ï¼‰
            log.error("åº“å­˜ä¸è¶³ï¼Œæ‰£å‡å¤±è´¥, productId={}, stock={}, required={}", 
                      productId, stock, quantity);
            throw new InsufficientStockException("åº“å­˜ä¸è¶³");
        }
    }
    
    public void payOrder(Order order) {
        try {
            paymentService.pay(order);
        } catch (Exception e) {
            // ERROR: å¼‚å¸¸ï¼ˆå¿…é¡»è®°å½•å †æ ˆï¼‰
            log.error("æ”¯ä»˜å¤±è´¥, orderNo={}, error={}", 
                      order.getOrderNo(), e.getMessage(), e);
            throw new PaymentException("æ”¯ä»˜å¤±è´¥", e);
        }
    }
}
```

### 4.2 æ—¥å¿—æ ¼å¼

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
// âœ… æ­£ç¡®ï¼šä½¿ç”¨å ä½ç¬¦
log.info("åˆ›å»ºè®¢å•, userId={}, productId={}, quantity={}", 
         userId, productId, quantity);

// âŒ é”™è¯¯ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆæ€§èƒ½å·®ï¼‰
log.info("åˆ›å»ºè®¢å•, userId=" + userId + ", productId=" + productId);

// âœ… æ­£ç¡®ï¼šè®°å½•å¼‚å¸¸å †æ ˆ
log.error("å¤„ç†å¤±è´¥, orderNo={}", orderNo, exception);

// âŒ é”™è¯¯ï¼šåªè®°å½• message
log.error("å¤„ç†å¤±è´¥, orderNo={}, error={}", orderNo, exception.getMessage());

// ğŸŸ¡ æ¨èï¼šå…³é”®ä¿¡æ¯ä½¿ç”¨ JSON
log.info("è®¢å•è¯¦æƒ…: {}", JSON.toJSONString(order));
```

### 4.3 æ•æ„Ÿä¿¡æ¯

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
// âŒ ç¦æ­¢ï¼šæ‰“å°æ•æ„Ÿä¿¡æ¯
log.info("ç”¨æˆ·ç™»å½•, password={}", password);         // å¯†ç 
log.info("æ”¯ä»˜ä¿¡æ¯, bankCard={}", bankCard);        // é“¶è¡Œå¡å·
log.info("ç”¨æˆ·æ‰‹æœºå·: {}", phone);                   // æ‰‹æœºå·

// âœ… æ­£ç¡®ï¼šè„±æ•å¤„ç†
log.info("ç”¨æˆ·ç™»å½•, password=***");
log.info("æ”¯ä»˜ä¿¡æ¯, bankCard={}", maskBankCard(bankCard));  // 6222*********1234
log.info("ç”¨æˆ·æ‰‹æœºå·: {}", maskPhone(phone));               // 138****5678
```

---

## ç¬¬äº”ç« ï¼šå¼‚å¸¸å¤„ç†è§„èŒƒ

### 5.1 å¼‚å¸¸åˆ†ç±»

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
/**
 * å¼‚å¸¸ä½“ç³»
 *
 * Exception
 * â”œâ”€â”€ RuntimeException
 * â”‚   â””â”€â”€ BusinessExceptionï¼ˆä¸šåŠ¡å¼‚å¸¸åŸºç±»ï¼‰
 * â”‚       â”œâ”€â”€ OrderNotFoundExceptionï¼ˆè®¢å•ä¸å­˜åœ¨ï¼‰
 * â”‚       â”œâ”€â”€ InsufficientStockExceptionï¼ˆåº“å­˜ä¸è¶³ï¼‰
 * â”‚       â”œâ”€â”€ PaymentExceptionï¼ˆæ”¯ä»˜å¼‚å¸¸ï¼‰
 * â”‚       â””â”€â”€ ...
 * â””â”€â”€ IOExceptionï¼ˆæ£€æŸ¥å¼‚å¸¸ï¼Œä¸æ¨èï¼‰
 */

/**
 * ä¸šåŠ¡å¼‚å¸¸åŸºç±»
 */
public class BusinessException extends RuntimeException {
    
    private final ErrorCode errorCode;
    
    public BusinessException(ErrorCode errorCode) {
        super(errorCode.getMessage());
        this.errorCode = errorCode;
    }
    
    public BusinessException(ErrorCode errorCode, String message) {
        super(message);
        this.errorCode = errorCode;
    }
    
    public BusinessException(ErrorCode errorCode, Throwable cause) {
        super(errorCode.getMessage(), cause);
        this.errorCode = errorCode;
    }
    
    public ErrorCode getErrorCode() {
        return errorCode;
    }
}

/**
 * å…·ä½“ä¸šåŠ¡å¼‚å¸¸
 */
public class OrderNotFoundException extends BusinessException {
    public OrderNotFoundException(String message) {
        super(ErrorCode.ORDER_NOT_FOUND, message);
    }
}

public class InsufficientStockException extends BusinessException {
    public InsufficientStockException(String message) {
        super(ErrorCode.INSUFFICIENT_STOCK, message);
    }
}
```

### 5.2 å¼‚å¸¸å¤„ç†

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
// âœ… æ­£ç¡®ï¼šæŠ›å‡ºæ˜ç¡®çš„ä¸šåŠ¡å¼‚å¸¸
public Order getOrderById(Long orderId) {
    return orderRepository.findById(orderId)
        .orElseThrow(() -> new OrderNotFoundException("è®¢å•ä¸å­˜åœ¨: " + orderId));
}

// âŒ é”™è¯¯ï¼šæŠ›å‡ºé€šç”¨å¼‚å¸¸
public Order getOrderById(Long orderId) {
    Order order = orderRepository.findById(orderId).orElse(null);
    if (order == null) {
        throw new RuntimeException("è®¢å•ä¸å­˜åœ¨");  // å¤ªæ³›åŒ–
    }
    return order;
}

// âœ… æ­£ç¡®ï¼šæ•è·å…·ä½“å¼‚å¸¸
public void processOrder(Order order) {
    try {
        orderRepository.save(order);
    } catch (DataAccessException e) {
        log.error("æ•°æ®åº“é”™è¯¯, orderNo={}", order.getOrderNo(), e);
        throw new DatabaseException("è®¢å•ä¿å­˜å¤±è´¥", e);
    }
}

// âŒ é”™è¯¯ï¼šæ•è·æ‰€æœ‰å¼‚å¸¸
public void processOrder(Order order) {
    try {
        orderRepository.save(order);
    } catch (Exception e) {  // å¤ªæ³›åŒ–
        e.printStackTrace();  // ä¸è¦ç”¨ printStackTrace
        throw new RuntimeException("å¤±è´¥");
    }
}

// ğŸ”´ ç¦æ­¢ï¼šç©º catch
try {
    // ...
} catch (Exception e) {
    // ä»€ä¹ˆéƒ½ä¸åšï¼ˆåæ‰å¼‚å¸¸ï¼‰
}

// ğŸ”´ ç¦æ­¢ï¼šåªæŠ›å‡º new Exception
throw new Exception("é”™è¯¯");  // ä½¿ç”¨å…·ä½“çš„å¼‚å¸¸ç±»
```

### 5.3 finally å’Œèµ„æºå…³é—­

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
// âœ… æ­£ç¡®ï¼štry-with-resourcesï¼ˆæ¨èï¼‰
public String readFile(String filePath) {
    try (BufferedReader reader = new BufferedReader(new FileReader(filePath))) {
        return reader.readLine();
    } catch (IOException e) {
        log.error("è¯»å–æ–‡ä»¶å¤±è´¥, filePath={}", filePath, e);
        throw new FileReadException("è¯»å–æ–‡ä»¶å¤±è´¥", e);
    }
}

// ğŸŸ¡ å¯é€‰ï¼šæ‰‹åŠ¨å…³é—­
public String readFile(String filePath) {
    BufferedReader reader = null;
    try {
        reader = new BufferedReader(new FileReader(filePath));
        return reader.readLine();
    } catch (IOException e) {
        log.error("è¯»å–æ–‡ä»¶å¤±è´¥, filePath={}", filePath, e);
        throw new FileReadException("è¯»å–æ–‡ä»¶å¤±è´¥", e);
    } finally {
        if (reader != null) {
            try {
                reader.close();
            } catch (IOException e) {
                log.error("å…³é—­æ–‡ä»¶å¤±è´¥", e);
            }
        }
    }
}
```

---

## ç¬¬å…­ç« ï¼šæ•°æ®åº“è§„èŒƒ

### 6.1 å®ä½“ç±»

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
/**
 * è®¢å•å®ä½“
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Entity
@Table(name = "t_order", indexes = {
    @Index(name = "idx_order_no", columnList = "order_no", unique = true),
    @Index(name = "idx_user_id", columnList = "user_id"),
    @Index(name = "idx_create_time", columnList = "create_time")
})
public class Order {
    
    /**
     * ä¸»é”®IDï¼ˆä½¿ç”¨é›ªèŠ±IDæˆ–æ•°æ®åº“è‡ªå¢ï¼‰
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    /**
     * è®¢å•å·ï¼ˆå”¯ä¸€ï¼Œä¸šåŠ¡ä¸»é”®ï¼‰
     */
    @Column(name = "order_no", unique = true, nullable = false, length = 64)
    private String orderNo;
    
    /**
     * ç”¨æˆ·ID
     */
    @Column(name = "user_id", nullable = false)
    private Long userId;
    
    /**
     * å•†å“ID
     */
    @Column(name = "product_id", nullable = false)
    private Long productId;
    
    /**
     * å•†å“åç§°
     */
    @Column(name = "product_name", nullable = false, length = 255)
    private String productName;
    
    /**
     * è´­ä¹°æ•°é‡
     */
    @Column(name = "quantity", nullable = false)
    private Integer quantity;
    
    /**
     * è®¢å•é‡‘é¢
     */
    @Column(name = "total_amount", nullable = false, precision = 10, scale = 2)
    private BigDecimal totalAmount;
    
    /**
     * è®¢å•çŠ¶æ€
     */
    @Enumerated(EnumType.STRING)
    @Column(name = "status", nullable = false, length = 20)
    private OrderStatus status;
    
    /**
     * åˆ›å»ºæ—¶é—´
     */
    @Column(name = "create_time", nullable = false, updatable = false)
    @CreatedDate
    private LocalDateTime createTime;
    
    /**
     * æ›´æ–°æ—¶é—´
     */
    @Column(name = "update_time", nullable = false)
    @LastModifiedDate
    private LocalDateTime updateTime;
    
    /**
     * é€»è¾‘åˆ é™¤æ ‡è®°ï¼ˆ0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤ï¼‰
     */
    @Column(name = "deleted", nullable = false)
    private Integer deleted = 0;
}
```

### 6.2 Repository

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
/**
 * è®¢å•æ•°æ®è®¿é—®å±‚
 */
public interface OrderRepository extends JpaRepository<Order, Long> {
    
    /**
     * æ ¹æ®è®¢å•å·æŸ¥è¯¢è®¢å•
     *
     * @param orderNo è®¢å•å·
     * @return è®¢å•
     */
    Optional<Order> findByOrderNo(String orderNo);
    
    /**
     * æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢è®¢å•åˆ—è¡¨
     *
     * @param userId ç”¨æˆ·ID
     * @return è®¢å•åˆ—è¡¨
     */
    List<Order> findByUserId(Long userId);
    
    /**
     * æ ¹æ®ç”¨æˆ·IDå’ŒçŠ¶æ€æŸ¥è¯¢è®¢å•
     *
     * @param userId ç”¨æˆ·ID
     * @param status è®¢å•çŠ¶æ€
     * @return è®¢å•åˆ—è¡¨
     */
    List<Order> findByUserIdAndStatus(Long userId, OrderStatus status);
    
    /**
     * æ ¹æ®ç”¨æˆ·IDå’Œåˆ›å»ºæ—¶é—´èŒƒå›´æŸ¥è¯¢è®¢å•
     *
     * @param userId ç”¨æˆ·ID
     * @param startTime å¼€å§‹æ—¶é—´
     * @param endTime ç»“æŸæ—¶é—´
     * @return è®¢å•åˆ—è¡¨
     */
    List<Order> findByUserIdAndCreateTimeBetween(
        Long userId, LocalDateTime startTime, LocalDateTime endTime
    );
    
    /**
     * ç»Ÿè®¡ç”¨æˆ·è®¢å•æ•°é‡
     *
     * @param userId ç”¨æˆ·ID
     * @return è®¢å•æ•°é‡
     */
    long countByUserId(Long userId);
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·è®¢å•ï¼ˆåˆ†é¡µï¼‰
     *
     * @param userId ç”¨æˆ·ID
     * @param pageable åˆ†é¡µå‚æ•°
     * @return è®¢å•åˆ†é¡µ
     */
    Page<Order> findByUserId(Long userId, Pageable pageable);
    
    /**
     * ä½¿ç”¨è‡ªå®šä¹‰ SQLï¼ˆå¤æ‚æŸ¥è¯¢ï¼‰
     *
     * @param userId ç”¨æˆ·ID
     * @param minAmount æœ€å°é‡‘é¢
     * @return è®¢å•åˆ—è¡¨
     */
    @Query("SELECT o FROM Order o WHERE o.userId = :userId AND o.totalAmount >= :minAmount")
    List<Order> findHighValueOrders(@Param("userId") Long userId, 
                                   @Param("minAmount") BigDecimal minAmount);
}
```

---

## ç¬¬ä¸ƒç« ï¼šService å±‚è§„èŒƒ

### 7.1 Service æ¥å£

**è§„èŒƒ**ï¼šğŸŸ¡ **æ¨è**ï¼ˆå¤æ‚ä¸šåŠ¡å»ºè®®å®šä¹‰æ¥å£ï¼‰

```java
/**
 * è®¢å•æœåŠ¡æ¥å£
 */
public interface OrderService {
    
    /**
     * åˆ›å»ºè®¢å•
     *
     * @param request è®¢å•è¯·æ±‚
     * @return è®¢å•å“åº”
     */
    OrderResponse createOrder(OrderRequest request);
    
    /**
     * æ ¹æ®IDæŸ¥è¯¢è®¢å•
     *
     * @param orderId è®¢å•ID
     * @return è®¢å•
     */
    Order getOrderById(Long orderId);
    
    /**
     * æ ¹æ®è®¢å•å·æŸ¥è¯¢è®¢å•
     *
     * @param orderNo è®¢å•å·
     * @return è®¢å•
     */
    Order getOrderByOrderNo(String orderNo);
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨
     *
     * @param userId ç”¨æˆ·ID
     * @param pageable åˆ†é¡µå‚æ•°
     * @return è®¢å•åˆ†é¡µ
     */
    Page<Order> listUserOrders(Long userId, Pageable pageable);
    
    /**
     * å–æ¶ˆè®¢å•
     *
     * @param orderId è®¢å•ID
     */
    void cancelOrder(Long orderId);
}
```

### 7.2 Service å®ç°

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
/**
 * è®¢å•æœåŠ¡å®ç°
 */
@Service
@Slf4j
public class OrderServiceImpl implements OrderService {
    
    @Autowired
    private OrderRepository orderRepository;
    
    @Autowired
    private OrderFactory orderFactory;
    
    @Autowired
    private InventoryService inventoryService;
    
    @Autowired
    private OrderEventPublisher eventPublisher;
    
    /**
     * åˆ›å»ºè®¢å•
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public OrderResponse createOrder(OrderRequest request) {
        log.info("åˆ›å»ºè®¢å•å¼€å§‹, userId={}, productId={}, quantity={}", 
                 request.getUserId(), request.getProductId(), request.getQuantity());
        
        // 1. å‚æ•°æ ¡éªŒ
        validateRequest(request);
        
        // 2. æ£€æŸ¥å¹¶æ‰£å‡åº“å­˜
        inventoryService.checkAndDeduct(request.getProductId(), request.getQuantity());
        
        // 3. åˆ›å»ºè®¢å•
        Order order = orderFactory.create(request);
        orderRepository.save(order);
        
        log.info("è®¢å•åˆ›å»ºæˆåŠŸ, orderNo={}, orderId={}", 
                 order.getOrderNo(), order.getId());
        
        // 4. å‘å¸ƒäº‹ä»¶
        eventPublisher.publishOrderCreated(order);
        
        // 5. è¿”å›ç»“æœ
        return OrderResponse.success(order);
    }
    
    /**
     * æŸ¥è¯¢è®¢å•
     */
    @Override
    public Order getOrderById(Long orderId) {
        Assert.notNull(orderId, "è®¢å•IDä¸èƒ½ä¸ºç©º");
        
        return orderRepository.findById(orderId)
            .orElseThrow(() -> new OrderNotFoundException("è®¢å•ä¸å­˜åœ¨: " + orderId));
    }
    
    /**
     * æ ¹æ®è®¢å•å·æŸ¥è¯¢
     */
    @Override
    public Order getOrderByOrderNo(String orderNo) {
        Assert.hasText(orderNo, "è®¢å•å·ä¸èƒ½ä¸ºç©º");
        
        return orderRepository.findByOrderNo(orderNo)
            .orElseThrow(() -> new OrderNotFoundException("è®¢å•ä¸å­˜åœ¨: " + orderNo));
    }
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨
     */
    @Override
    public Page<Order> listUserOrders(Long userId, Pageable pageable) {
        Assert.notNull(userId, "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
        Assert.notNull(pageable, "åˆ†é¡µå‚æ•°ä¸èƒ½ä¸ºç©º");
        
        return orderRepository.findByUserId(userId, pageable);
    }
    
    /**
     * å–æ¶ˆè®¢å•
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public void cancelOrder(Long orderId) {
        log.info("å–æ¶ˆè®¢å•, orderId={}", orderId);
        
        // 1. æŸ¥è¯¢è®¢å•
        Order order = getOrderById(orderId);
        
        // 2. æ£€æŸ¥è®¢å•çŠ¶æ€
        if (order.getStatus() != OrderStatus.PENDING 
            && order.getStatus() != OrderStatus.PAID) {
            throw new BusinessException(ErrorCode.ORDER_CANNOT_CANCEL, 
                                      "å½“å‰çŠ¶æ€ä¸èƒ½å–æ¶ˆ");
        }
        
        // 3. å–æ¶ˆè®¢å•
        order.setStatus(OrderStatus.CANCELLED);
        order.setUpdateTime(LocalDateTime.now());
        orderRepository.save(order);
        
        // 4. é‡Šæ”¾åº“å­˜
        inventoryService.release(order.getProductId(), order.getQuantity());
        
        // 5. å‘å¸ƒäº‹ä»¶
        eventPublisher.publishOrderCancelled(order);
        
        log.info("è®¢å•å–æ¶ˆæˆåŠŸ, orderNo={}", order.getOrderNo());
    }
    
    /**
     * æ ¡éªŒè¯·æ±‚å‚æ•°
     */
    private void validateRequest(OrderRequest request) {
        Assert.notNull(request, "è¯·æ±‚å‚æ•°ä¸èƒ½ä¸ºç©º");
        Assert.notNull(request.getUserId(), "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
        Assert.notNull(request.getProductId(), "å•†å“IDä¸èƒ½ä¸ºç©º");
        Assert.notNull(request.getQuantity(), "è´­ä¹°æ•°é‡ä¸èƒ½ä¸ºç©º");
        Assert.isTrue(request.getQuantity() > 0, "è´­ä¹°æ•°é‡å¿…é¡»å¤§äº0");
    }
}
```

---

## ç¬¬å…«ç« ï¼šController å±‚è§„èŒƒ

### 8.1 Controller

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
/**
 * è®¢å•æ§åˆ¶å™¨
 */
@RestController
@RequestMapping("/api/orders")
@Slf4j
@Api(tags = "è®¢å•ç®¡ç†")
public class OrderController {
    
    @Autowired
    private OrderService orderService;
    
    /**
     * åˆ›å»ºè®¢å•
     */
    @PostMapping
    @ApiOperation("åˆ›å»ºè®¢å•")
    public ApiResponse<OrderResponse> createOrder(
            @Valid @RequestBody OrderRequest request) {
        
        log.info("åˆ›å»ºè®¢å•è¯·æ±‚: userId={}, productId={}", 
                 request.getUserId(), request.getProductId());
        
        OrderResponse response = orderService.createOrder(request);
        
        return ApiResponse.success(response);
    }
    
    /**
     * æŸ¥è¯¢è®¢å•è¯¦æƒ…
     */
    @GetMapping("/{orderId}")
    @ApiOperation("æŸ¥è¯¢è®¢å•è¯¦æƒ…")
    public ApiResponse<OrderVO> getOrder(
            @PathVariable @NotNull @Positive Long orderId) {
        
        log.info("æŸ¥è¯¢è®¢å•: orderId={}", orderId);
        
        Order order = orderService.getOrderById(orderId);
        OrderVO vo = OrderVO.from(order);
        
        return ApiResponse.success(vo);
    }
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨
     */
    @GetMapping("/user/{userId}")
    @ApiOperation("æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨")
    public ApiResponse<Page<OrderVO>> listUserOrders(
            @PathVariable @NotNull @Positive Long userId,
            @RequestParam(defaultValue = "0") @Min(0) Integer page,
            @RequestParam(defaultValue = "10") @Min(1) @Max(100) Integer size) {
        
        log.info("æŸ¥è¯¢ç”¨æˆ·è®¢å•: userId={}, page={}, size={}", userId, page, size);
        
        Pageable pageable = PageRequest.of(page, size, Sort.by("createTime").descending());
        Page<Order> orderPage = orderService.listUserOrders(userId, pageable);
        Page<OrderVO> voPage = orderPage.map(OrderVO::from);
        
        return ApiResponse.success(voPage);
    }
    
    /**
     * å–æ¶ˆè®¢å•
     */
    @DeleteMapping("/{orderId}")
    @ApiOperation("å–æ¶ˆè®¢å•")
    public ApiResponse<Void> cancelOrder(
            @PathVariable @NotNull @Positive Long orderId) {
        
        log.info("å–æ¶ˆè®¢å•: orderId={}", orderId);
        
        orderService.cancelOrder(orderId);
        
        return ApiResponse.success();
    }
}
```

### 8.2 DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```java
/**
 * è®¢å•è¯·æ±‚ DTO
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@ApiModel("è®¢å•è¯·æ±‚")
public class OrderRequest {
    
    /**
     * ç”¨æˆ·ID
     */
    @ApiModelProperty(value = "ç”¨æˆ·ID", required = true, example = "1001")
    @NotNull(message = "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º")
    @Positive(message = "ç”¨æˆ·IDå¿…é¡»å¤§äº0")
    private Long userId;
    
    /**
     * å•†å“ID
     */
    @ApiModelProperty(value = "å•†å“ID", required = true, example = "2001")
    @NotNull(message = "å•†å“IDä¸èƒ½ä¸ºç©º")
    @Positive(message = "å•†å“IDå¿…é¡»å¤§äº0")
    private Long productId;
    
    /**
     * å•†å“åç§°
     */
    @ApiModelProperty(value = "å•†å“åç§°", required = true, example = "iPhone 15 Pro")
    @NotBlank(message = "å•†å“åç§°ä¸èƒ½ä¸ºç©º")
    @Length(max = 100, message = "å•†å“åç§°é•¿åº¦ä¸èƒ½è¶…è¿‡100")
    private String productName;
    
    /**
     * è´­ä¹°æ•°é‡
     */
    @ApiModelProperty(value = "è´­ä¹°æ•°é‡", required = true, example = "2")
    @NotNull(message = "è´­ä¹°æ•°é‡ä¸èƒ½ä¸ºç©º")
    @Min(value = 1, message = "è´­ä¹°æ•°é‡è‡³å°‘ä¸º1")
    @Max(value = 999, message = "è´­ä¹°æ•°é‡ä¸èƒ½è¶…è¿‡999")
    private Integer quantity;
    
    /**
     * è®¢å•é‡‘é¢
     */
    @ApiModelProperty(value = "è®¢å•é‡‘é¢", required = true, example = "16998.00")
    @NotNull(message = "è®¢å•é‡‘é¢ä¸èƒ½ä¸ºç©º")
    @DecimalMin(value = "0.01", message = "è®¢å•é‡‘é¢å¿…é¡»å¤§äº0")
    @DecimalMax(value = "999999.99", message = "è®¢å•é‡‘é¢ä¸èƒ½è¶…è¿‡999999.99")
    private BigDecimal totalAmount;
}

/**
 * è®¢å•å“åº” DTO
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@ApiModel("è®¢å•å“åº”")
public class OrderResponse {
    
    /**
     * è®¢å•ID
     */
    @ApiModelProperty("è®¢å•ID")
    private Long orderId;
    
    /**
     * è®¢å•å·
     */
    @ApiModelProperty("è®¢å•å·")
    private String orderNo;
    
    /**
     * è®¢å•çŠ¶æ€
     */
    @ApiModelProperty("è®¢å•çŠ¶æ€")
    private OrderStatus status;
    
    /**
     * åˆ›å»ºæ—¶é—´
     */
    @ApiModelProperty("åˆ›å»ºæ—¶é—´")
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime createTime;
    
    /**
     * æ„å»ºæˆåŠŸå“åº”
     */
    public static OrderResponse success(Order order) {
        return OrderResponse.builder()
            .orderId(order.getId())
            .orderNo(order.getOrderNo())
            .status(order.getStatus())
            .createTime(order.getCreateTime())
            .build();
    }
}
```

### 8.3 VOï¼ˆè§†å›¾å¯¹è±¡ï¼‰

**è§„èŒƒ**ï¼šğŸŸ¡ **æ¨è**

```java
/**
 * è®¢å• VOï¼ˆè¿”å›ç»™å‰ç«¯ï¼‰
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@ApiModel("è®¢å•è§†å›¾å¯¹è±¡")
public class OrderVO {
    
    @ApiModelProperty("è®¢å•ID")
    private Long orderId;
    
    @ApiModelProperty("è®¢å•å·")
    private String orderNo;
    
    @ApiModelProperty("ç”¨æˆ·ID")
    private Long userId;
    
    @ApiModelProperty("å•†å“ID")
    private Long productId;
    
    @ApiModelProperty("å•†å“åç§°")
    private String productName;
    
    @ApiModelProperty("è´­ä¹°æ•°é‡")
    private Integer quantity;
    
    @ApiModelProperty("è®¢å•é‡‘é¢")
    private BigDecimal totalAmount;
    
    @ApiModelProperty("è®¢å•çŠ¶æ€")
    private String status;
    
    @ApiModelProperty("çŠ¶æ€æè¿°")
    private String statusDesc;
    
    @ApiModelProperty("åˆ›å»ºæ—¶é—´")
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime createTime;
    
    /**
     * ä» Entity è½¬æ¢ä¸º VO
     */
    public static OrderVO from(Order order) {
        return OrderVO.builder()
            .orderId(order.getId())
            .orderNo(order.getOrderNo())
            .userId(order.getUserId())
            .productId(order.getProductId())
            .productName(order.getProductName())
            .quantity(order.getQuantity())
            .totalAmount(order.getTotalAmount())
            .status(order.getStatus().name())
            .statusDesc(order.getStatus().getDescription())
            .createTime(order.getCreateTime())
            .build();
    }
}
```

---

## ç¬¬ä¹ç« ï¼šæµ‹è¯•è§„èŒƒ

### 9.1 å•å…ƒæµ‹è¯•

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**ï¼ˆæ ¸å¿ƒä¸šåŠ¡å¿…é¡»æœ‰å•å…ƒæµ‹è¯•ï¼‰

```java
/**
 * è®¢å•æœåŠ¡å•å…ƒæµ‹è¯•
 */
@SpringBootTest
@Slf4j
class OrderServiceTest {
    
    @Autowired
    private OrderService orderService;
    
    @MockBean
    private OrderRepository orderRepository;
    
    @MockBean
    private InventoryService inventoryService;
    
    /**
     * æµ‹è¯•åˆ›å»ºè®¢å•-æˆåŠŸ
     */
    @Test
    @DisplayName("åˆ›å»ºè®¢å•-æˆåŠŸ")
    void testCreateOrder_Success() {
        // Givenï¼ˆå‡†å¤‡æ•°æ®ï¼‰
        OrderRequest request = OrderRequest.builder()
            .userId(1001L)
            .productId(2001L)
            .productName("iPhone 15 Pro")
            .quantity(2)
            .totalAmount(new BigDecimal("16998.00"))
            .build();
        
        Order order = Order.builder()
            .id(1L)
            .orderNo("ORD202501010001")
            .userId(1001L)
            .productId(2001L)
            .quantity(2)
            .totalAmount(new BigDecimal("16998.00"))
            .status(OrderStatus.PENDING)
            .build();
        
        // Whenï¼ˆæ¨¡æ‹Ÿè¡Œä¸ºï¼‰
        when(orderRepository.save(any(Order.class))).thenReturn(order);
        
        // Thenï¼ˆæ‰§è¡Œå¹¶æ–­è¨€ï¼‰
        OrderResponse response = orderService.createOrder(request);
        
        assertNotNull(response);
        assertEquals("ORD202501010001", response.getOrderNo());
        assertEquals(OrderStatus.PENDING, response.getStatus());
        
        // éªŒè¯æ–¹æ³•è°ƒç”¨
        verify(inventoryService, times(1))
            .checkAndDeduct(2001L, 2);
        verify(orderRepository, times(1))
            .save(any(Order.class));
    }
    
    /**
     * æµ‹è¯•åˆ›å»ºè®¢å•-åº“å­˜ä¸è¶³
     */
    @Test
    @DisplayName("åˆ›å»ºè®¢å•-åº“å­˜ä¸è¶³")
    void testCreateOrder_InsufficientStock() {
        // Given
        OrderRequest request = OrderRequest.builder()
            .userId(1001L)
            .productId(2001L)
            .quantity(100)
            .build();
        
        // When
        doThrow(new InsufficientStockException("åº“å­˜ä¸è¶³"))
            .when(inventoryService)
            .checkAndDeduct(2001L, 100);
        
        // Then
        assertThrows(InsufficientStockException.class, () -> {
            orderService.createOrder(request);
        });
    }
    
    /**
     * æµ‹è¯•æŸ¥è¯¢è®¢å•-å­˜åœ¨
     */
    @Test
    @DisplayName("æŸ¥è¯¢è®¢å•-å­˜åœ¨")
    void testGetOrderById_Exists() {
        // Given
        Long orderId = 1L;
        Order order = Order.builder()
            .id(orderId)
            .orderNo("ORD202501010001")
            .build();
        
        // When
        when(orderRepository.findById(orderId))
            .thenReturn(Optional.of(order));
        
        // Then
        Order result = orderService.getOrderById(orderId);
        
        assertNotNull(result);
        assertEquals(orderId, result.getId());
        assertEquals("ORD202501010001", result.getOrderNo());
    }
    
    /**
     * æµ‹è¯•æŸ¥è¯¢è®¢å•-ä¸å­˜åœ¨
     */
    @Test
    @DisplayName("æŸ¥è¯¢è®¢å•-ä¸å­˜åœ¨")
    void testGetOrderById_NotFound() {
        // Given
        Long orderId = 999L;
        
        // When
        when(orderRepository.findById(orderId))
            .thenReturn(Optional.empty());
        
        // Then
        assertThrows(OrderNotFoundException.class, () -> {
            orderService.getOrderById(orderId);
        });
    }
}
```

---

## ç¬¬åç« ï¼šGit è§„èŒƒ

### 10.1 åˆ†æ”¯å‘½å

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```
master/main     - ä¸»åˆ†æ”¯ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
develop         - å¼€å‘åˆ†æ”¯
feature/xxx     - åŠŸèƒ½åˆ†æ”¯ï¼ˆå¦‚ feature/order-serviceï¼‰
bugfix/xxx      - Bug ä¿®å¤åˆ†æ”¯ï¼ˆå¦‚ bugfix/order-amountï¼‰
hotfix/xxx      - ç´§æ€¥ä¿®å¤åˆ†æ”¯ï¼ˆå¦‚ hotfix/payment-errorï¼‰
release/xxx     - å‘å¸ƒåˆ†æ”¯ï¼ˆå¦‚ release/v1.0.0ï¼‰
```

### 10.2 æäº¤æ¶ˆæ¯

**è§„èŒƒ**ï¼šğŸ”´ **å¼ºåˆ¶**

```
æ ¼å¼ï¼š<type>(<scope>): <subject>

typeï¼ˆå¿…é¡»ï¼‰ï¼š
- feat: æ–°åŠŸèƒ½
- fix: ä¿®å¤ Bug
- docs: æ–‡æ¡£å˜æ›´
- style: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œï¼‰
- refactor: é‡æ„
- perf: æ€§èƒ½ä¼˜åŒ–
- test: æµ‹è¯•
- chore: æ„å»º/å·¥å…·å˜æ›´

scopeï¼ˆå¯é€‰ï¼‰ï¼šå½±å“èŒƒå›´
subjectï¼ˆå¿…é¡»ï¼‰ï¼šç®€çŸ­æè¿°

ç¤ºä¾‹ï¼š
âœ… æ­£ç¡®ï¼š
  feat(order): æ·»åŠ è®¢å•åˆ›å»ºåŠŸèƒ½
  fix(inventory): ä¿®å¤åº“å­˜æ‰£å‡å¹¶å‘é—®é¢˜
  docs(readme): æ›´æ–°éƒ¨ç½²æ–‡æ¡£
  refactor(service): é‡æ„è®¢å•æœåŠ¡
  perf(cache): ä¼˜åŒ– Redis ç¼“å­˜ç­–ç•¥

âŒ é”™è¯¯ï¼š
  update
  fix bug
  ä¿®æ”¹ä»£ç 
```

---

## é™„å½•ï¼šIDEA é…ç½®

### A.1 ä»£ç æ¨¡æ¿

**File â†’ Settings â†’ Editor â†’ File and Code Templates**

**Java Class Template**ï¼š

```java
#if (${PACKAGE_NAME} && ${PACKAGE_NAME} != "")package ${PACKAGE_NAME};#end

/**
 * ${NAME}
 *
 * @author ${USER}
 * @since ${DATE}
 */
public class ${NAME} {
}
```

### A.2 ä»£ç æ£€æŸ¥

**File â†’ Settings â†’ Editor â†’ Inspections**

å¯ç”¨ï¼š
- Java â†’ Probable bugs
- Java â†’ Code style issues
- Java â†’ Naming conventions
- Java â†’ Imports

### A.3 å¿«æ·é”®

```
Ctrl + Alt + L        - æ ¼å¼åŒ–ä»£ç 
Ctrl + Alt + O        - ä¼˜åŒ–å¯¼å…¥
Ctrl + /              - è¡Œæ³¨é‡Š
Ctrl + Shift + /      - å—æ³¨é‡Š
Alt + Enter           - å¿«é€Ÿä¿®å¤
Ctrl + Shift + T      - åˆ›å»ºæµ‹è¯•
```

---

## æ€»ç»“

æœ¬è§„èŒƒè¦†ç›–ï¼š

### æ ¸å¿ƒè§„èŒƒ
- âœ… å‘½åè§„èŒƒï¼ˆåŒ…ã€ç±»ã€æ–¹æ³•ã€å˜é‡ï¼‰
- âœ… ä»£ç æ ¼å¼ï¼ˆç¼©è¿›ã€ç©ºè¡Œã€å¤§æ‹¬å·ï¼‰
- âœ… æ³¨é‡Šè§„èŒƒï¼ˆç±»ã€æ–¹æ³•ã€å­—æ®µï¼‰
- âœ… æ—¥å¿—è§„èŒƒï¼ˆçº§åˆ«ã€æ ¼å¼ã€æ•æ„Ÿä¿¡æ¯ï¼‰
- âœ… å¼‚å¸¸å¤„ç†è§„èŒƒ
- âœ… æ•°æ®åº“è§„èŒƒ
- âœ… å„å±‚è§„èŒƒï¼ˆControllerã€Serviceã€Repositoryï¼‰
- âœ… æµ‹è¯•è§„èŒƒ
- âœ… Git è§„èŒƒ

### å¼ºåˆ¶ç­‰çº§
- ğŸ”´ **å¼ºåˆ¶**ï¼š10+ æ¡ï¼ˆå¿…é¡»éµå®ˆï¼‰
- ğŸŸ¡ **æ¨è**ï¼š8+ æ¡ï¼ˆå»ºè®®éµå®ˆï¼‰
- ğŸŸ¢ **å‚è€ƒ**ï¼š5+ æ¡ï¼ˆå¯é€‰ï¼‰

### é¢„æœŸæ•ˆæœ
- ä»£ç é£æ ¼ç»Ÿä¸€ 100%
- å¯è¯»æ€§æå‡ 80%+
- Bug ç‡é™ä½ 50%+
- å›¢é˜Ÿåä½œæ•ˆç‡æå‡ 40%+

---

**ä¸‹ä¸€æ­¥**ï¼šæŒ‰ç…§æœ¬è§„èŒƒé‡æ„é¡¹ç›®ä»£ç ï¼Œè®©ä»£ç æ›´ä¼˜é›…ã€æ›´ä¸“ä¸šï¼ğŸš€

