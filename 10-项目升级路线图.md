# Java 微服务项目升级路线图

## 📍 当前位置：第一版（基础版）✅

你已经完成：
- ✅ 基础微服务架构（订单、库存、通知）
- ✅ PostgreSQL + Redis + Kafka + RabbitMQ + Nacos
- ✅ Spring Cloud Gateway
- ✅ Prometheus + Grafana + SkyWalking
- ✅ Docker 容器化部署

---

## 🎯 升级目标：企业级生产环境标准

---

## 🗺️ 升级路线图

```
第一版（基础）
    ↓
┌───────────────────────────────────────┐
│  阶段一：保证数据一致性               │
│  ⏰ 预计 3-5 天                       │
│                                       │
│  ✅ Seata 分布式事务                 │
│     - 订单 + 库存的事务一致性        │
│     - 掌握 AT 模式原理               │
│     - 理解 undo_log 回滚机制         │
│                                       │
│  🎯 面试重点：分布式事务解决方案     │
└───────────────────────────────────────┘
    ↓
┌───────────────────────────────────────┐
│  阶段二：保护系统稳定性               │
│  ⏰ 预计 3-5 天                       │
│                                       │
│  ✅ Sentinel 流量控制                │
│     - QPS 限流（每秒最多 10 个请求） │
│     - 错误率熔断（超过 50% 自动熔断）│
│     - 降级处理（返回友好提示）       │
│                                       │
│  🎯 面试重点：如何应对高并发流量     │
└───────────────────────────────────────┘
    ↓
┌───────────────────────────────────────┐
│  阶段三：优化缓存性能                 │
│  ⏰ 预计 4-6 天                       │
│                                       │
│  ✅ Redis 高级特性                   │
│     - Redisson 分布式锁              │
│       （防止库存超卖）               │
│     - 布隆过滤器                     │
│       （防止缓存穿透）               │
│     - 多级缓存                       │
│       （Caffeine + Redis）           │
│                                       │
│  🎯 面试重点：缓存三大问题           │
│     穿透、击穿、雪崩的解决方案       │
└───────────────────────────────────────┘
    ↓
┌───────────────────────────────────────┐
│  阶段四：支持海量数据                 │
│  ⏰ 预计 5-7 天                       │
│                                       │
│  ✅ ShardingSphere 分库分表          │
│     - 按 user_id 分库（2个库）       │
│     - 按 order_no 分表（每库4张表）  │
│     - 自动路由 SQL                   │
│                                       │
│  🎯 面试重点：数据库水平扩展方案     │
└───────────────────────────────────────┘
    ↓
┌───────────────────────────────────────┐
│  阶段五：实现全文搜索                 │
│  ⏰ 预计 4-6 天                       │
│                                       │
│  ✅ Elasticsearch 搜索               │
│     - 部署 ELK 栈                    │
│     - 商品搜索服务                   │
│     - 全文搜索 + 价格筛选 + 分类     │
│                                       │
│  🎯 面试加分项：复杂搜索实现         │
└───────────────────────────────────────┘
    ↓
┌───────────────────────────────────────┐
│  阶段六：保证消息可靠性               │
│  ⏰ 预计 2-3 天                       │
│                                       │
│  ✅ RabbitMQ 高级特性                │
│     - 死信队列                       │
│     - 消息确认机制                   │
│     - 手动 ACK                       │
│                                       │
│  🎯 面试重点：消息可靠性保证         │
└───────────────────────────────────────┘
    ↓
┌───────────────────────────────────────┐
│  阶段七：完善系统功能                 │
│  ⏰ 预计 5-7 天                       │
│                                       │
│  ✅ Spring Security + JWT            │
│     - 统一认证授权                   │
│     - Token 验证                     │
│                                       │
│  ✅ XXL-Job 定时任务                 │
│     - 清理旧订单                     │
│     - 取消超时订单                   │
│                                       │
│  ✅ MinIO 对象存储                   │
│     - 文件上传下载                   │
│                                       │
│  🎯 面试加分项：完整的系统功能       │
└───────────────────────────────────────┘
    ↓
┌───────────────────────────────────────┐
│  阶段八：优化监控告警                 │
│  ⏰ 预计 2-3 天                       │
│                                       │
│  ✅ 高级监控                         │
│     - Grafana 告警规则               │
│     - SkyWalking 自定义埋点          │
│     - ELK 日志分析                   │
│                                       │
│  🎯 面试加分项：完整的监控体系       │
└───────────────────────────────────────┘
    ↓
┌───────────────────────────────────────┐
│  最终版本：企业级微服务系统 🎉       │
└───────────────────────────────────────┘
```

---

## 📊 技能树对比

### 第一版技能树
```
基础版
├── 微服务框架
│   ├── Spring Boot
│   ├── Spring Cloud Gateway
│   └── Nacos 服务注册
├── 数据存储
│   ├── PostgreSQL（单库单表）
│   └── Redis（简单缓存）
├── 消息队列
│   ├── Kafka（基础发送）
│   └── RabbitMQ（基础消费）
└── 监控
    ├── Prometheus
    ├── Grafana
    └── SkyWalking
```

### 升级版技能树
```
企业级
├── 微服务框架
│   ├── Spring Boot
│   ├── Spring Cloud Gateway + JWT 验证
│   ├── Nacos 服务注册 + 配置中心
│   └── Sentinel 流量控制
├── 数据一致性
│   └── Seata 分布式事务 ⭐
├── 数据存储
│   ├── PostgreSQL
│   │   ├── 单库单表（第一版）
│   │   └── 分库分表（ShardingSphere）⭐
│   └── Redis
│       ├── 简单缓存（第一版）
│       ├── 分布式锁（Redisson）⭐
│       ├── 布隆过滤器 ⭐
│       └── 多级缓存（Caffeine + Redis）⭐
├── 搜索引擎
│   └── Elasticsearch 全文搜索 ⭐
├── 消息队列
│   ├── Kafka（基础发送）
│   └── RabbitMQ
│       ├── 基础消费（第一版）
│       ├── 死信队列 ⭐
│       └── 消息确认机制 ⭐
├── 任务调度
│   └── XXL-Job 分布式定时任务 ⭐
├── 对象存储
│   └── MinIO 文件管理 ⭐
├── 安全认证
│   └── Spring Security + JWT ⭐
└── 监控告警
    ├── Prometheus + Grafana（告警规则）⭐
    ├── SkyWalking（自定义埋点）⭐
    └── ELK 日志系统 ⭐
```

---

## 🎯 学习重点分级

### 🔥 面试必备（优先级最高）

| 技术 | 重要性 | 难度 | 学习时间 | 面试频率 |
|------|--------|------|----------|----------|
| Seata 分布式事务 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 3-5天 | 90% |
| Sentinel 限流降级 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | 3-5天 | 85% |
| Redis 高级特性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 4-6天 | 95% |
| ShardingSphere | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 5-7天 | 70% |

### ⭐ 面试加分（优先级中等）

| 技术 | 重要性 | 难度 | 学习时间 | 面试频率 |
|------|--------|------|----------|----------|
| Elasticsearch | ⭐⭐⭐⭐ | ⭐⭐⭐ | 4-6天 | 60% |
| RabbitMQ 高级 | ⭐⭐⭐ | ⭐⭐⭐ | 2-3天 | 50% |
| JWT 认证 | ⭐⭐⭐ | ⭐⭐ | 2-3天 | 65% |

### 💡 了解即可（优先级较低）

| 技术 | 重要性 | 难度 | 学习时间 | 面试频率 |
|------|--------|------|----------|----------|
| XXL-Job | ⭐⭐ | ⭐⭐ | 2-3天 | 30% |
| MinIO | ⭐⭐ | ⭐ | 1-2天 | 20% |
| ELK 日志 | ⭐⭐⭐ | ⭐⭐⭐ | 2-3天 | 40% |

---

## 📝 每个阶段的学习建议

### 阶段一：Seata 分布式事务

**学习步骤**：
1. Day 1: 理解分布式事务的概念和问题
   - 了解 CAP 理论
   - 理解 2PC、3PC、TCC、Saga 模式
   - 为什么选择 Seata AT 模式

2. Day 2: 部署 Seata Server
   - Docker 启动 Seata
   - 配置 Nacos 注册中心
   - 创建 Seata 数据库和表

3. Day 3: 微服务集成
   - 添加 Seata 依赖
   - 创建 undo_log 表
   - 配置数据源代理

4. Day 4: 代码实现
   - 使用 @GlobalTransactional 注解
   - 订单服务远程调用库存服务
   - 模拟异常触发回滚

5. Day 5: 测试和调试
   - 测试正常流程
   - 测试异常回滚
   - 查看 Seata 日志

**核心面试问题**：
- 什么是分布式事务？为什么需要？
- Seata 的 AT 模式原理？
- 如何保证分布式事务的一致性？
- undo_log 表的作用？
- 如何处理分布式事务失败？

---

### 阶段二：Sentinel 流量控制

**学习步骤**：
1. Day 1: 理解流量控制概念
   - 什么是限流、降级、熔断
   - 常见限流算法（漏桶、令牌桶）
   - 熔断的三种状态

2. Day 2: 部署 Sentinel Dashboard
   - Docker 启动 Sentinel
   - 访问控制台

3. Day 3: 集成 Sentinel
   - 添加依赖
   - 配置 Nacos 数据源
   - 使用 @SentinelResource 注解

4. Day 4: 配置规则
   - 流控规则（QPS 限流）
   - 熔断规则（错误率熔断）
   - 降级方法实现

5. Day 5: 压测验证
   - 使用 JMeter 或 ab 工具
   - 观察 Sentinel Dashboard
   - 验证限流和熔断效果

**核心面试问题**：
- 如何保护系统不被大流量冲垮？
- 限流算法有哪些？Sentinel 用的哪种？
- 熔断和降级的区别？
- 如何配置限流规则？
- 如何处理被限流的请求？

---

### 阶段三：Redis 高级特性

**学习步骤**：
1. Day 1-2: 理解缓存三大问题
   - 缓存穿透：查询不存在的数据
   - 缓存击穿：热点数据过期
   - 缓存雪崩：大量缓存同时过期

2. Day 3-4: Redisson 分布式锁
   - 添加 Redisson 依赖
   - 实现分布式锁扣减库存
   - 理解锁的自动续期机制

3. Day 5: 布隆过滤器
   - 创建布隆过滤器
   - 初始化商品 ID
   - 防止缓存穿透

4. Day 6: 多级缓存
   - 集成 Caffeine 本地缓存
   - 实现三级缓存（本地 → Redis → DB）
   - 缓存更新策略

**核心面试问题**：
- 什么是缓存穿透、击穿、雪崩？如何解决？
- 分布式锁的实现原理？
- Redisson 如何防止锁超时？
- 布隆过滤器的原理和误判率？
- 多级缓存的优势？

---

### 阶段四：ShardingSphere 分库分表

**学习步骤**：
1. Day 1-2: 理解分库分表概念
   - 为什么需要分库分表
   - 垂直分库 vs 水平分库
   - 垂直分表 vs 水平分表

2. Day 3-4: 配置 ShardingSphere
   - 添加依赖
   - 配置多数据源
   - 配置分片规则

3. Day 5-6: 创建分库分表
   - 创建多个数据库
   - 创建多张分表
   - 导入测试数据

4. Day 7: 测试和优化
   - 测试数据路由
   - 查看 SQL 日志
   - 处理跨库查询

**核心面试问题**：
- 什么时候需要分库分表？
- 分片策略有哪些？
- 如何选择分片键？
- 跨库查询如何处理？
- 分布式 ID 如何生成？

---

## 🎓 面试准备清单

### 核心问题准备（务必掌握）

#### 1. 分布式事务
- [ ] 什么是分布式事务？为什么需要？
- [ ] Seata 的工作原理？
- [ ] AT 模式、TCC 模式、Saga 模式的区别？
- [ ] 如何保证分布式事务的一致性？
- [ ] undo_log 表的作用？

#### 2. 高并发
- [ ] 如何防止缓存穿透、击穿、雪崩？
- [ ] 分布式锁的实现原理？
- [ ] 如何保证库存不超卖？
- [ ] 如何应对突然的大流量？
- [ ] 限流算法有哪些？

#### 3. 数据库优化
- [ ] 什么时候需要分库分表？
- [ ] 如何选择分片键？
- [ ] 跨库查询如何处理？
- [ ] 分布式 ID 如何生成？
- [ ] 数据库索引优化？

#### 4. 消息可靠性
- [ ] 如何保证消息不丢失？
- [ ] 如何处理消息重复消费？
- [ ] 死信队列的作用？
- [ ] Kafka 和 RabbitMQ 的区别？
- [ ] 消息积压如何处理？

#### 5. 微服务治理
- [ ] 服务雪崩如何处理？
- [ ] 熔断降级的原理？
- [ ] 服务限流如何实现？
- [ ] 如何做链路追踪？
- [ ] 服务监控如何实现？

---

## 📈 能力提升对比

### 第一版完成后

**技术能力**：
- ✅ 掌握基础微服务架构
- ✅ 会用基础中间件
- ✅ 能搭建简单的业务系统
- ✅ 了解容器化部署

**面试评价**：
- 有项目经验（基础）
- 能回答简单问题
- 缺乏高级场景经验

**薪资范围**：8K - 15K（初级-中级）

---

### 升级版完成后

**技术能力**：
- ✅ 掌握企业级微服务架构
- ✅ 解决分布式事务问题
- ✅ 应对高并发场景
- ✅ 处理海量数据
- ✅ 保证系统稳定性
- ✅ 完整的监控和告警

**面试评价**：
- 有企业级项目经验
- 能解决复杂技术问题
- 有高并发实战经验
- 技术深度和广度兼备

**薪资范围**：15K - 30K（中高级）

---

## 🎯 总结

### 升级版核心价值

1. **解决真实业务问题**
   - 分布式事务保证数据一致性
   - 限流降级保证系统稳定性
   - 分库分表支持海量数据
   - 缓存优化提升系统性能

2. **掌握企业级技术栈**
   - Seata、Sentinel、ShardingSphere
   - Elasticsearch、Redisson
   - XXL-Job、MinIO
   - ELK、JWT

3. **提升面试竞争力**
   - 回答高频面试题
   - 展示项目亮点
   - 体现技术深度
   - 证明实战能力

---

## 📞 学习建议

### 遇到困难时

1. **理解原理优先**：不要死记硬背，理解为什么这么做
2. **动手实践为主**：所有功能都要亲自实现一遍
3. **及时记录总结**：遇到的问题和解决方案要记录
4. **画图帮助理解**：画架构图、流程图、时序图
5. **模拟面试练习**：找朋友或自己录音练习回答

### 时间安排建议

- **有时间系统学习**：建议 4-6 周完成升级版
- **需要快速准备面试**：优先学习 4 个面试必备模块（2-3 周）
- **想深入研究**：每个模块都要搞懂原理和源码（2-3 个月）

---

**记住：项目是死的，人是活的。重要的不是做了什么项目，而是在项目中学到了什么，能解决什么问题！**

**祝你学习顺利，面试成功！加油！💪**

